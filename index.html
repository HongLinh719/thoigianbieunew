<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Th·ªùi gian bi·ªÉu cho b√©</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<style>
        :root {
            --primary-color: #FF7043;
            --secondary-color: #FFAB91;
            --neutral-color: #FBE9E7;
            --text-color: #3E2723;
            --light-text: #795548;
            --success-color: #66BB6A;
            --warning-color: #FFCA28;
            --danger-color: #EF5350;
        }
        
        body {
            font-family: 'Baloo 2', cursive;
            margin: 0;
            padding: 0;
            background-color: var(--neutral-color);
            color: var(--text-color);
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
        }
        
        .date-container {
            background-color: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .date-display {
            font-size: 18px;
            font-weight: 600;
        }
        
        .date-nav {
            display: flex;
            gap: 15px;
        }
        
        .date-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .progress {
            height: 30px;
            background-color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            text-align: center;
            line-height: 30px;
            color: white;
            font-weight: 600;
            transition: width 0.5s;
        }
        
        .task-list {
            margin-bottom: 20px;
        }
        
        .task {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .task.completed-good {
            border-left: 5px solid var(--success-color);
        }
        
        .task.completed-neutral {
            border-left: 5px solid var(--warning-color);
        }
        
        .task.completed-bad {
            border-left: 5px solid var(--danger-color);
        }
        
        .task-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-time {
            background-color: var(--neutral-color);
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: 600;
            margin-right: 10px;
            font-size: 14px;
        }
        
        .task-name {
            font-weight: 600;
            font-size: 16px;
            flex-grow: 1;
        }
        
        .rating-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .rating-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .good-btn {
            background-color: #E8F5E9;
            color: var(--success-color);
        }
        
        .good-btn:hover, .good-btn.active {
            background-color: var(--success-color);
            color: white;
        }
        
        .neutral-btn {
            background-color: #FFF8E1;
            color: var(--warning-color);
        }
        
        .neutral-btn:hover, .neutral-btn.active {
            background-color: var(--warning-color);
            color: white;
        }
        
        .bad-btn {
            background-color: #FFEBEE;
            color: var(--danger-color);
        }
        
        .bad-btn:hover, .bad-btn.active {
            background-color: var(--danger-color);
            color: white;
        }
        
        .reward {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #FFD54F, #FFCA28);
            border-radius: 12px;
            margin-top: 20px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }
        
        .reward.active {
            display: block;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            animation: slideDown 0.5s;
        }
        
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        .stats-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .stats-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .stats-modal.active {
            visibility: visible;
            opacity: 1;
        }
        
        .stats-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .stats-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .stats-chart {
            height: 200px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }
        
        .chart-bar {
            flex: 1;
            background-color: var(--primary-color);
            transition: height 0.5s;
            border-radius: 5px 5px 0 0;
            position: relative;
            min-width: 30px;
        }
        
        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
        }
        
        .chart-bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: 600;
        }
        
        .stats-summary {
            margin-top: 40px;
            background-color: var(--neutral-color);
            padding: 15px;
            border-radius: 10px;
        }
        
        .sleep-record {
            display: flex;
            justify-content: space-between;
            background-color: #E8F5E9;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .sleep-record.good {
            background-color: #E8F5E9;
            border-left: 4px solid var(--success-color);
        }
        
        .sleep-record.neutral {
            background-color: #FFF8E1;
            border-left: 4px solid var(--warning-color);
        }
        
        .sleep-record.bad {
            background-color: #FFEBEE;
            border-left: 4px solid var(--danger-color);
        }
    /* Responsive design cho ƒëi·ªán tho·∫°i */
    @media screen and (max-width: 768px) {
        body {
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            padding: 10px;
            margin: 0;
        }

        /* ƒêi·ªÅu ch·ªânh header */
        .header {
            margin: 0 0 15px 0;
            border-radius: 0;
        }

        .header h1 {
            font-size: 20px;
        }



        /* ƒêi·ªÅu ch·ªânh c√¢y v√† n√∫t t∆∞·ªõi n∆∞·ªõc */
        div[style*="position: fixed; bottom: 500px; right: 340px;"] {
            position: static !important;
            width: 100% !important;
            margin: 10px 0;
            text-align: center;
        }

        #tree-img {
            width: 120px !important;
            height: 120px !important;
        }

        /* ƒêi·ªÅu ch·ªânh huy hi·ªáu */
        div[style*="position: fixed; top: 100px; right: 20px;"] {
            position: static !important;
            width: 100% !important;
            margin: 10px 0;
            padding: 10px;
            box-sizing: border-box;
        }

        /* ƒêi·ªÅu ch·ªânh tabs */
        .tabs {
            margin: 10px 0;
        }

        .tab {
            padding: 8px;
            font-size: 14px;
        }

        .tab img {
            width: 20px;
            height: 20px;
        }

        /* ƒêi·ªÅu ch·ªânh nhi·ªám v·ª• */
        .task {
            margin-bottom: 10px;
        }

        .task-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .task-time {
            margin-bottom: 5px;
            width: 100%;
            text-align: left;
        }

        .task-name {
            width: 100%;
        }

        .rating-buttons {
            flex-direction: column;
            gap: 5px;
        }

        .rating-btn {
            width: 100%;
            padding: 12px;
            justify-content: center;
        }

        /* ƒêi·ªÅu ch·ªânh hi·ªáu ·ª©ng t∆∞·ªõi n∆∞·ªõc */
        #watering-gif {
            width: 80px !important;
            height: auto !important;
            top: auto !important;
            left: 50% !important;
            transform: translateX(-50%);
            z-index: 1000;
        }

        /* ƒêi·ªÅu ch·ªânh popup ch√∫c m·ª´ng */
        #popup-congrats {
            width: 90% !important;
            max-width: 300px;
        }

        #popup-congrats img {
            width: 150px !important;
            height: auto !important;
        }

        /* ƒêi·ªÅu ch·ªânh n√∫t th·ªëng k√™ */
        .stats-btn {
            width: 40px;
            height: 40px;
            font-size: 20px;
            bottom: 10px;
            right: 10px;
        }

        .stats-content {
            width: 95%;
            max-width: none;
            margin: 10px;
            padding: 15px;
        }

        /* T·ªëi ∆∞u hi·ªáu ·ª©ng */
        .notification {
            width: 90%;
            font-size: 14px;
            padding: 10px;
        }

        /* T·ªëi ∆∞u scrolling */
        html {
            scroll-behavior: smooth;
        }

        * {
            -webkit-tap-highlight-color: transparent;
        }
    }
</style>
</head>
<body>
    


<!-- Th√™m v√†o ph·∫ßn JavaScript ƒë·ªÉ x·ª≠ l√Ω chuy·ªÉn ƒë·ªïi hi·ªÉn th·ªã -->
<script>
// C·∫≠p nh·∫≠t h√†m switchTab ƒë·ªÉ hi·ªÉn th·ªã ƒë√∫ng profile
let originalSwitchTab;
if (typeof switchTab !== 'undefined') {
    originalSwitchTab = switchTab;
    switchTab = function(childName) {
        originalSwitchTab(childName);
        updateLevelDisplay();
        
        // ·∫®n/hi·ªán profile t∆∞∆°ng ·ª©ng
        document.getElementById('tridung-profile').style.display = childName === 'tridung' ? 'block' : 'none';
        document.getElementById('thaoVy-profile').style.display = childName === 'thaoVy' ? 'block' : 'none';
    };
}
</script>
<div class="container">
<div class="header">
<h1>Th·ªùi gian bi·ªÉu cho b√©</h1>
</div>
<div class="date-container">
<div class="date-display" id="currentDate">H√¥m nay, 17/04/2025</div>
<div class="date-nav">
<button class="date-btn" onclick="changeDate(-1)"><i class="fas fa-chevron-left"></i></button>
<button class="date-btn" onclick="changeDate(1)"><i class="fas fa-chevron-right"></i></button>
</div>
</div>

<div class="tabs">
    <div class="tab active" onclick="switchTab('tridung')">
        <img src="images/vit.jpg" style="width:30px; height:30px; border-radius:50%; margin-right:5px; vertical-align:middle;">
        Tr√≠ D≈©ng (5 tu·ªïi)
    </div>
    <div class="tab" onclick="switchTab('thaoVy')">
        <img src="images/vy.jpg" style="width:30px; height:30px; border-radius:50%; margin-right:5px; vertical-align:middle;">
        Th·∫£o Vy (3 tu·ªïi)
    </div>
</div>

<style>
.tab {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    /* ...existing styles... */
}

.tab img {
    transition: transform 0.3s ease;
}

.tab:hover img {
    transform: scale(1.1);
}

.tab.active img {
    border: 2px solid #fff;
    box-shadow: 0 0 5px rgba(0,0,0,0.2);
}
</style>

<div class="progress">
<div class="progress-bar" id="progressBar" style="width: 0%">0/16 ƒëi·ªÉm</div>
</div>
<div class="child-tab" id="tridung">
<div class="sleep-record" id="sleepRecord">
<div><i class="fas fa-bed"></i> Ng·ªß ƒë√™m qua:</div>
<div id="sleepStatus">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
</div>
<div class="task-list">
<!-- Tasks will be added here dynamically -->
</div>
</div>
<div class="child-tab" id="thaoVy" style="display:none">
<div class="sleep-record" id="sleepRecordThaoVy">
<div><i class="fas fa-bed"></i> Ng·ªß ƒë√™m qua:</div>
<div id="sleepStatusThaoVy">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
</div>
<div class="task-list">
<!-- Tasks will be added here dynamically -->
</div>
</div>
<div class="reward" id="reward">
<i class="fas fa-trophy"></i> Ch√∫c m·ª´ng! B√© ƒë√£ ho√†n th√†nh nhi·ªám v·ª• v√† ƒë∆∞·ª£c ph√©p ch∆°i thi·∫øt b·ªã ƒëi·ªán t·ª≠ t·ª´ 20:00 - 21:00
        </div>
</div>
<div class="notification" id="notification">
<i class="fas fa-bell"></i> ƒê·∫øn gi·ªù th·ª±c hi·ªán nhi·ªám v·ª• m·ªõi!
    </div>
<button class="stats-btn" onclick="toggleStats()">
<i class="fas fa-chart-bar"></i>
</button>
<div class="stats-modal" id="statsModal">
<div class="stats-content">
<div class="stats-header">
<h2>Th·ªëng k√™ ho·∫°t ƒë·ªông</h2>
<button class="stats-close" onclick="toggleStats()"><i class="fas fa-times"></i></button>
</div>
<div class="stats-chart" id="statsChart">
<!-- Chart bars will be added here -->
</div>
<div class="stats-summary">
<h3>T√≥m t·∫Øt 7 ng√†y qua</h3>
<p><strong>T·ªïng ƒëi·ªÉm:</strong> <span id="totalPoints">0</span> ƒëi·ªÉm</p>
<p><strong>ƒêi·ªÉm trung b√¨nh:</strong> <span id="averagePoints">0</span> ƒëi·ªÉm/ng√†y</p>
<p><strong>Ng√†y t·ªët nh·∫•t:</strong> <span id="bestDay">Ch∆∞a c√≥ d·ªØ li·ªáu</span></p>
<p><strong>S·ªë ng√†y ƒë∆∞·ª£c ch∆°i thi·∫øt b·ªã:</strong> <span id="deviceDays">0</span>/7 ng√†y</p>
</div>
</div>
</div>
<script>
        // Thi·∫øt l·∫≠p ng√†y hi·ªán t·∫°i
        let currentDate = new Date();
        let currentChild = 'tridung';
        
        // D·ªØ li·ªáu l∆∞u tr·ªØ
        const storageKey = 'kidScheduleData';
        let scheduleData = {
            tridung: {},
            thaoVy: {}
        };
        
        // H·∫°ng m·ª•c ƒë√°nh gi√°
        const ratingValues = {
            good: 3,
            neutral: 1,
            bad: 0
        };
        
        // Danh s√°ch nhi·ªám v·ª• c·ªë ƒë·ªãnh
        const taskTemplates = {
            tridung: [
                { id: 1, time: "21:00", name: "ƒêi ng·ªß (ƒë√™m qua)", isPreviousSleep: true, ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] },
                { id: 2, time: "6:30 - 7:00", name: "Th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n, ƒëi h·ªçc", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 3, time: "17:00 - 18:00", name: "Ch∆°i t·ª± do", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 4, time: "18:00 - 18:30", name: "ƒÇn t·ªëi t·∫°i nh√†", ratings: ["ƒÇn nhanh v√† nhi·ªÅu", "ƒÇn ch·∫≠m", "Kh√¥ng ch·ªãu ƒÉn"] },
                { id: 5, time: "18:30 - 19:00", name: "V·ªá sinh c√° nh√¢n bu·ªïi t·ªëi", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 6, time: "19:00 - 20:00", name: "ƒê·ªçc s√°ch, t√¥ m√†u ho·∫∑c l√†m to√°n", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 7, time: "21:00", name: "ƒêi ng·ªß", ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] }
            ],
            thaoVy: [
                { id: 1, time: "21:00", name: "ƒêi ng·ªß (ƒë√™m qua)", isPreviousSleep: true, ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] },
                { id: 2, time: "6:30 - 7:00", name: "Th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n, ƒëi h·ªçc", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 3, time: "17:00 - 18:00", name: "Ch∆°i t·ª± do", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 4, time: "18:00 - 18:30", name: "ƒÇn t·ªëi t·∫°i nh√†", ratings: ["ƒÇn nhanh v√† nhi·ªÅu", "ƒÇn ch·∫≠m", "Kh√¥ng ch·ªãu ƒÉn"] },
                { id: 5, time: "18:30 - 19:00", name: "V·ªá sinh c√° nh√¢n bu·ªïi t·ªëi", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 6, time: "19:00 - 20:00", name: "ƒê·ªçc s√°ch, t√¥ m√†u", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 7, time: "21:00", name: "ƒêi ng·ªß", ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] }
            ]
        };
        
        // Hi·ªÉn th·ªã ng√†y hi·ªán t·∫°i
        function updateDateDisplay() {
            const options = { weekday: 'long', day: 'numeric', month: 'numeric', year: 'numeric' };
            const dateString = currentDate.toLocaleDateString('vi-VN', options);
            const capitalizedDate = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            document.getElementById('currentDate').textContent = capitalizedDate;
        }
        
        // ƒê·ªïi ng√†y
        function changeDate(delta) {
            const newDate = new Date(currentDate);
            newDate.setDate(newDate.getDate() + delta);
            currentDate = newDate;
            updateDateDisplay();
            renderTasks();
            updateSleepRecord();
            checkReward();
        }
        
        // L·∫•y key cho ng√†y hi·ªán t·∫°i
        function getDateKey(date = currentDate) {
            return date.toISOString().split('T')[0];
        }
        
        // L·∫•y key cho ng√†y h√¥m tr∆∞·ªõc
        function getPreviousDateKey() {
            const prevDate = new Date(currentDate);
            prevDate.setDate(prevDate.getDate() - 1);
            return getDateKey(prevDate);
        }
        
        // C·∫≠p nh·∫≠t tr·∫°ng th√°i ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc
        function updateSleepRecord() {
            const prevDateKey = getPreviousDateKey();
            const currentDateKey = getDateKey();
            
            // Ki·ªÉm tra tr·∫°ng th√°i ng·ªß cho Tr√≠ D≈©ng
            const sleepStatus = document.getElementById('sleepStatus');
            if (scheduleData.tridung[prevDateKey] && scheduleData.tridung[prevDateKey].tasks) {
                const sleepTask = scheduleData.tridung[prevDateKey].tasks.find(t => t.id === 7);
                if (sleepTask && sleepTask.rating) {
                    sleepStatus.textContent = sleepTask.rating === 'good' ? 'T·ªët' : 
                                              sleepTask.rating === 'neutral' ? 'Tr·ªÖ gi·ªù' : 'Kh√¥ng ng·ªß';
                    
                    const sleepRecord = document.getElementById('sleepRecord');
                    sleepRecord.className = 'sleep-record ' + sleepTask.rating;
                } else {
                    sleepStatus.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                    document.getElementById('sleepRecord').className = 'sleep-record';
                }
            } else {
                sleepStatus.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                document.getElementById('sleepRecord').className = 'sleep-record';
            }
            
            // Ki·ªÉm tra tr·∫°ng th√°i ng·ªß cho Th·∫£o Vy
            const sleepStatusThaoVy = document.getElementById('sleepStatusThaoVy');
            if (scheduleData.thaoVy[prevDateKey] && scheduleData.thaoVy[prevDateKey].tasks) {
                const sleepTaskThaoVy = scheduleData.thaoVy[prevDateKey].tasks.find(t => t.id === 7);
                if (sleepTaskThaoVy && sleepTaskThaoVy.rating) {
                    sleepStatusThaoVy.textContent = sleepTaskThaoVy.rating === 'good' ? 'T·ªët' : 
                                                  sleepTaskThaoVy.rating === 'neutral' ? 'Tr·ªÖ gi·ªù' : 'Kh√¥ng ng·ªß';
                    
                    const sleepRecordThaoVy = document.getElementById('sleepRecordThaoVy');
                    sleepRecordThaoVy.className = 'sleep-record ' + sleepTaskThaoVy.rating;
                } else {
                    sleepStatusThaoVy.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                    document.getElementById('sleepRecordThaoVy').className = 'sleep-record';
                }
            } else {
                sleepStatusThaoVy.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                document.getElementById('sleepRecordThaoVy').className = 'sleep-record';
            }
            
            // Chu·∫©n b·ªã d·ªØ li·ªáu cho ng√†y hi·ªán t·∫°i n·∫øu ch∆∞a c√≥
            ['tridung', 'thaoVy'].forEach(child => {
                if (!scheduleData[child][currentDateKey]) {
                    scheduleData[child][currentDateKey] = {
                        tasks: [],
                        totalPoints: 0
                    };
                    
                    // T·∫°o c√°c nhi·ªám v·ª• t·ª´ template
                    scheduleData[child][currentDateKey].tasks = taskTemplates[child].map(template => {
                        return {
                            id: template.id,
                            time: template.time,
                            name: template.name,
                            isPreviousSleep: template.isPreviousSleep || false,
                            rating: null
                        };
                    });
                }
            });
        }
        
        // Hi·ªÉn th·ªã danh s√°ch nhi·ªám v·ª•
        function renderTasks() {
            const dateKey = getDateKey();
            
            // Render nhi·ªám v·ª• cho Tr√≠ D≈©ng
            const tridungTaskList = document.querySelector('#tridung .task-list');
            tridungTaskList.innerHTML = '';
            
            if (scheduleData.tridung[dateKey] && scheduleData.tridung[dateKey].tasks) {
                // L·ªçc ra nhi·ªám v·ª• c·ªßa ng√†y hi·ªán t·∫°i (kh√¥ng ph·∫£i ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc)
                const currentTasks = scheduleData.tridung[dateKey].tasks.filter(task => !task.isPreviousSleep);
                
                currentTasks.forEach(task => {
                    const taskElement = createTaskElement(task, 'tridung');
                    tridungTaskList.appendChild(taskElement);
                });
            }
            
            // Render nhi·ªám v·ª• cho Th·∫£o Vy
            const thaoVyTaskList = document.querySelector('#thaoVy .task-list');
            thaoVyTaskList.innerHTML = '';
            
            if (scheduleData.thaoVy[dateKey] && scheduleData.thaoVy[dateKey].tasks) {
                // L·ªçc ra nhi·ªám v·ª• c·ªßa ng√†y hi·ªán t·∫°i (kh√¥ng ph·∫£i ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc)
                const currentTasks = scheduleData.thaoVy[dateKey].tasks.filter(task => !task.isPreviousSleep);
                
                currentTasks.forEach(task => {
                    const taskElement = createTaskElement(task, 'thaoVy');
                    thaoVyTaskList.appendChild(taskElement);
                });
            }
            
            updateProgress();
        }
        
        // T·∫°o ph·∫ßn t·ª≠ nhi·ªám v·ª•
        function createTaskElement(task, childName) {
            const taskElement = document.createElement('div');
            taskElement.className = `task ${task.rating ? 'completed-' + task.rating : ''}`;
            
            const template = taskTemplates[childName].find(t => t.id === task.id);
            
            taskElement.innerHTML = `
                <div class="task-header">
                    <div class="task-time">${task.time}</div>
                    <div class="task-name">${task.name}</div>
                </div>
                <div class="rating-buttons">
                    <button class="rating-btn good-btn ${task.rating === 'good' ? 'active' : ''}" 
                            onclick="rateTask('${childName}', ${task.id}, 'good')">
                        <i class="fas fa-smile"></i> ${template.ratings[0]}
                    </button>
                    <button class="rating-btn neutral-btn ${task.rating === 'neutral' ? 'active' : ''}" 
                            onclick="rateTask('${childName}', ${task.id}, 'neutral')">
                        <i class="fas fa-meh"></i> ${template.ratings[1]}
                    </button>
                    <button class="rating-btn bad-btn ${task.rating === 'bad' ? 'active' : ''}" 
                            onclick="rateTask('${childName}', ${task.id}, 'bad')">
                        <i class="fas fa-frown"></i> ${template.ratings[2]}
                    </button>
                </div>
            `;
            
            return taskElement;
        }
        
        
        // T√≠nh l·∫°i t·ªïng ƒëi·ªÉm
        function recalculateTotalPoints(childName, dateKey) {
            let totalPoints = 0;
            
            if (scheduleData[childName][dateKey] && scheduleData[childName][dateKey].tasks) {
                scheduleData[childName][dateKey].tasks.forEach(task => {
                    if (task.rating) {
                        totalPoints += ratingValues[task.rating];
                    }
                });
scheduleData[childName][dateKey].totalPoints = totalPoints;
            }
        }
        
        // C·∫≠p nh·∫≠t thanh ti·∫øn tr√¨nh
        function updateProgress() {
            const dateKey = getDateKey();
            const childData = scheduleData[currentChild][dateKey];
            
            if (childData) {
                const totalPoints = childData.totalPoints || 0;
                const maxPoints = taskTemplates[currentChild].length * 3;
                const progressPercent = (totalPoints / maxPoints) * 100;
                
                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = `${progressPercent}%`;
                progressBar.textContent = `${totalPoints}/${maxPoints} ƒëi·ªÉm`;
            }
        }
        
        // Ki·ªÉm tra xem c√≥ ƒë·∫°t y√™u c·∫ßu nh·∫≠n ph·∫ßn th∆∞·ªüng kh√¥ng
        function checkReward() {
            const dateKey = getDateKey();
            const prevDateKey = getPreviousDateKey();
            
            // Ki·ªÉm tra xem c√≥ d·ªØ li·ªáu cho ng√†y hi·ªán t·∫°i v√† ng√†y h√¥m tr∆∞·ªõc kh√¥ng
            if (!scheduleData[currentChild][dateKey] || !scheduleData[currentChild][prevDateKey]) {
                document.getElementById('reward').classList.remove('active');
                return;
            }
            
            // Ki·ªÉm tra ƒë√°nh gi√° ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc
            const previousSleepTask = scheduleData[currentChild][prevDateKey].tasks.find(t => t.id === 7);
            const goodSleepYesterday = previousSleepTask && (previousSleepTask.rating === 'good' || previousSleepTask.rating === 'neutral');
            
            // Ki·ªÉm tra t·ªïng ƒëi·ªÉm c·ªßa ng√†y h√¥m nay (c·∫ßn ƒë·∫°t √≠t nh·∫•t 12 ƒëi·ªÉm)
            const goodPointsToday = scheduleData[currentChild][dateKey].totalPoints >= 12;
            
            // Hi·ªÉn th·ªã ph·∫ßn th∆∞·ªüng n·∫øu ƒë·ªß ƒëi·ªÅu ki·ªán
            const rewardElement = document.getElementById('reward');
            if (goodSleepYesterday && goodPointsToday) {
                rewardElement.classList.add('active');
            } else {
                rewardElement.classList.remove('active');
            }
        }
        
        // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c tab
        function switchTab(childName) {
            currentChild = childName;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i tab
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`.tab[onclick="switchTab('${childName}')"]`);
            activeTab.classList.add('active');
            
            // Hi·ªÉn th·ªã tab con t∆∞∆°ng ·ª©ng
            const childTabs = document.querySelectorAll('.child-tab');
            childTabs.forEach(tab => {
                tab.style.display = 'none';
            });
            
            // S·ª≠a t√™n bi·∫øn cho ƒë√∫ng - thaoVy th√†nh thaoVy
            document.getElementById(childName === 'tridung' ? 'tridung' : 'thaoVy').style.display = 'block';
            
            // ·∫®n/hi·ªán profile t∆∞∆°ng ·ª©ng
            document.getElementById('tridung-profile').style.display = childName === 'tridung' ? 'block' : 'none';
            document.getElementById('thaoVy-profile').style.display = childName === 'thaoVy' ? 'block' : 'none';
            
            // C·∫≠p nh·∫≠t ti·∫øn tr√¨nh v√† tr·∫°ng th√°i ph·∫ßn th∆∞·ªüng
            updateProgress();
            checkReward();
        }
        
        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.innerHTML = `<i class="fas fa-bell"></i> ${message}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
        
        // Ki·ªÉm tra th√¥ng b√°o d·ª±a tr√™n th·ªùi gian
        function checkTaskNotifications() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            
            const dateKey = getDateKey();
            
            // Ki·ªÉm tra c·∫£ hai b√©
            ['tridung', 'thaoVy'].forEach(childName => {
                if (scheduleData[childName][dateKey] && scheduleData[childName][dateKey].tasks) {
                    scheduleData[childName][dateKey].tasks.forEach(task => {
                        if (!task.isPreviousSleep) { // B·ªè qua nhi·ªám v·ª• ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc
                            const timeRange = task.time.split(' - ');
                            if (timeRange.length > 1) {
                                const startTime = timeRange[0].split(':');
                                const startHour = parseInt(startTime[0]);
                                const startMinute = parseInt(startTime[1]);
                                
                                if (hours === startHour && minutes === startMinute && !task.rating) {
                                    showNotification(`${childName === 'tridung' ? 'Tr√≠ D≈©ng' : 'Th·∫£o Vy'}: ƒê·∫øn gi·ªù ${task.name}`);
                                }
                            } else if (timeRange[0].includes(':')) {
                                const exactTime = timeRange[0].split(':');
                                const exactHour = parseInt(exactTime[0]);
                                const exactMinute = parseInt(exactTime[1]);
                                
                                if (hours === exactHour && minutes === exactMinute && !task.rating) {
                                    showNotification(`${childName === 'tridung' ? 'Tr√≠ D≈©ng' : 'Th·∫£o Vy'}: ƒê·∫øn gi·ªù ${task.name}`);
                                }
                            }
                        }
                    });
                }
            });
        }
        
        // Hi·ªÉn th·ªã/·∫©n modal th·ªëng k√™
        function toggleStats() {
            const statsModal = document.getElementById('statsModal');
            statsModal.classList.toggle('active');
            
            if (statsModal.classList.contains('active')) {
                updateStats();
            }
        }
        
        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            const statsChart = document.getElementById('statsChart');
            statsChart.innerHTML = '';
            
            // L·∫•y d·ªØ li·ªáu 7 ng√†y g·∫ßn nh·∫•t
            const last7Days = [];
            let totalPoints = 0;
            let deviceDays = 0;
            let bestDay = { date: null, points: 0 };
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - i);
                const dateKey = getDateKey(date);
                
                // Format ng√†y hi·ªÉn th·ªã
                const dayDisplay = date.getDate() + '/' + (date.getMonth() + 1);
                
                // D·ªØ li·ªáu ƒëi·ªÉm
                let dayPoints = 0;
                if (scheduleData[currentChild][dateKey] && scheduleData[currentChild][dateKey].totalPoints) {
                    dayPoints = scheduleData[currentChild][dateKey].totalPoints;
                }
                
                // Th√™m v√†o t·ªïng ƒëi·ªÉm
                totalPoints += dayPoints;
                
                // Ki·ªÉm tra ng√†y t·ªët nh·∫•t
                if (dayPoints > bestDay.points) {
                    bestDay = {
                        date: new Date(date),
                        points: dayPoints
                    };
                }
                
                // Ki·ªÉm tra xem ng√†y ƒë√≥ c√≥ ƒë∆∞·ª£c ch∆°i thi·∫øt b·ªã kh√¥ng
                const prevDate = new Date(date);
                prevDate.setDate(prevDate.getDate() - 1);
                const prevDateKey = getDateKey(prevDate);
                
                // ƒêi·ªÅu ki·ªán ƒë∆∞·ª£c ch∆°i thi·∫øt b·ªã: Ng·ªß t·ªët ng√†y h√¥m tr∆∞·ªõc + ƒëi·ªÉm cao ng√†y h√¥m nay
                let canUseDevice = false;
                
                if (scheduleData[currentChild][prevDateKey] && scheduleData[currentChild][dateKey]) {
                    const previousSleepTask = scheduleData[currentChild][prevDateKey].tasks?.find(t => t.id === 7);
                    const goodSleepYesterday = previousSleepTask && (previousSleepTask.rating === 'good' || previousSleepTask.rating === 'neutral');
                    const goodPointsToday = dayPoints >= 12;
                    
                    canUseDevice = goodSleepYesterday && goodPointsToday;
                    if (canUseDevice) deviceDays++;
                }
                
                // Th√™m v√†o m·∫£ng d·ªØ li·ªáu
                last7Days.push({
                    date: dayDisplay,
                    points: dayPoints,
                    canUseDevice: canUseDevice
                });
            }
            
            // T·∫°o bi·ªÉu ƒë·ªì
            last7Days.forEach(day => {
                // T√≠nh chi·ªÅu cao d·ª±a tr√™n ƒëi·ªÉm (t·ªëi ƒëa 21 ƒëi·ªÉm ~ chi·ªÅu cao 100%)
                const heightPercent = (day.points / 21) * 100;
                
                const barElement = document.createElement('div');
                barElement.className = `chart-bar ${day.canUseDevice ? 'good-btn' : ''}`;
                barElement.style.height = `${heightPercent}%`;
                
                barElement.innerHTML = `
                    <div class="chart-bar-value">${day.points}</div>
                    <div class="chart-bar-label">${day.date}</div>
                `;
                
                statsChart.appendChild(barElement);
            });
            
            // C·∫≠p nh·∫≠t t√≥m t·∫Øt th·ªëng k√™
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('averagePoints').textContent = (totalPoints / 7).toFixed(1);
            document.getElementById('deviceDays').textContent = deviceDays;
            
            if (bestDay.date) {
                const options = { weekday: 'long', day: 'numeric', month: 'numeric' };
                const bestDayStr = bestDay.date.toLocaleDateString('vi-VN', options);
                document.getElementById('bestDay').textContent = `${bestDayStr} (${bestDay.points} ƒëi·ªÉm)`;
            } else {
                document.getElementById('bestDay').textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
            }
        }
        


// S·ª≠a h√†m saveData ƒë·ªÉ l∆∞u d·ªØ li·ªáu c√¢y
// H√†m l∆∞u d·ªØ li·ªáu
function saveData() {
    localStorage.setItem(storageKey, JSON.stringify(scheduleData));
    
    // L∆∞u d·ªØ li·ªáu c√¢y
    localStorage.setItem('treeData', JSON.stringify({
        waterCredits: waterCredits,
        treeLevel: treeLevel
    }));
}
function updateTreeImage() {
    // X√°c ƒë·ªãnh c·∫•p ƒë·ªô c√¢y d·ª±a v√†o ng√†y trong tu·∫ßn
    const weekDay = new Date().getDay(); // 0: Ch·ªß Nh·∫≠t, 1: Th·ª© 2...
    
    // N·∫øu l√† ch·ªß nh·∫≠t, hi·ªÉn th·ªã c√¢y tr∆∞·ªüng th√†nh
    if (weekDay === 0) {
        document.getElementById("tree-img").src = "images/tree_day7.png";
        document.getElementById("tree-status").textContent = "C√¢y ƒë√£ tr∆∞·ªüng th√†nh ho√†n to√†n! Ch√∫c m·ª´ng b√©!";
        document.getElementById("tree-status").style.color = "#4CAF50";
    } else {
        // C√°c ng√†y kh√°c trong tu·∫ßn, hi·ªÉn th·ªã theo ti·∫øn ƒë·ªô
        // Th·ª© 2 (1) -> c·∫•p ƒë·ªô 1, Th·ª© 3 (2) -> c·∫•p ƒë·ªô 2, ..., Th·ª© 7 (6) -> c·∫•p ƒë·ªô 6
        const expectedLevel = weekDay; // C·∫•p ƒë·ªô mong ƒë·ª£i cho ng√†y hi·ªán t·∫°i
        
        // Hi·ªÉn th·ªã c√¢y theo c·∫•p ƒë·ªô th·ª±c t·∫ø (kh√¥ng v∆∞·ª£t qu√° c·∫•p ƒë·ªô mong ƒë·ª£i)
        const displayLevel = Math.min(treeLevel, expectedLevel);
        document.getElementById("tree-img").src = `images/tree_day${displayLevel}.png`;
        
        // Hi·ªÉn th·ªã th√¥ng b√°o v·ªÅ tr·∫°ng th√°i c√¢y
        if (treeLevel < expectedLevel) {
            document.getElementById("tree-status").textContent = "C√¢y c·∫ßn th√™m n∆∞·ªõc ƒë·ªÉ ph√°t tri·ªÉn!";
            document.getElementById("tree-status").style.color = "#FF9800";
        } else {
            document.getElementById("tree-status").textContent = "C√¢y ƒëang ph√°t tri·ªÉn t·ªët!";
            document.getElementById("tree-status").style.color = "#4CAF50";
        }
    }
}

// H√†m t·∫£i d·ªØ li·ªáu
function loadData() {
    const savedData = localStorage.getItem(storageKey);
    if (savedData) {
        scheduleData = JSON.parse(savedData);
    }
    
    // T·∫£i d·ªØ li·ªáu c√¢y
    const treeData = localStorage.getItem('treeData');
    if (treeData) {
        const parsedTreeData = JSON.parse(treeData);
        waterCredits = parsedTreeData.waterCredits || 0;
        treeLevel = parsedTreeData.treeLevel || 1;
        
        // C·∫≠p nh·∫≠t UI
        document.getElementById("water-units").textContent = waterCredits;
        updateTreeImage();
        
        console.log("ƒê√£ t·∫£i d·ªØ li·ªáu: l∆∞·ª£t t∆∞·ªõi =", waterCredits, "c·∫•p ƒë·ªô c√¢y =", treeLevel);
    }
    
    // L·∫•y ng√†y trong tu·∫ßn hi·ªán t·∫°i
    currentWeekDay = new Date().getDay(); // 0: Ch·ªß Nh·∫≠t, 1: Th·ª© 2...
    
    // Kh·ªüi t·∫°o ng√†y hi·ªán t·∫°i n·∫øu ch∆∞a c√≥
    initializeCurrentDate();
    checkAndResetTree();
    updateDateDisplay();
    updateSleepRecord();
    renderTasks();
    checkReward();
}
        
        // Kh·ªüi t·∫°o d·ªØ li·ªáu cho ng√†y hi·ªán t·∫°i n·∫øu ch∆∞a c√≥
        function initializeCurrentDate() {
            const dateKey = getDateKey();
            
            ['tridung', 'thaoVy'].forEach(child => {
                if (!scheduleData[child][dateKey]) {
                    scheduleData[child][dateKey] = {
                        tasks: [],
                        totalPoints: 0
                    };
                    
                    // T·∫°o c√°c nhi·ªám v·ª• t·ª´ template
                    scheduleData[child][dateKey].tasks = taskTemplates[child].map(template => {
                        return {
                            id: template.id,
                            time: template.time,
                            name: template.name,
                            isPreviousSleep: template.isPreviousSleep || false,
                            rating: null
                        };
                    });
                }
            });
        }
        
        // Ki·ªÉm tra th√¥ng b√°o m·ªói ph√∫t
        setInterval(checkTaskNotifications, 60000);
        
        // Th√™m s·ª± ki·ªán l∆∞u d·ªØ li·ªáu
        window.addEventListener('beforeunload', saveData);
        
        // Kh·ªüi ch·∫°y ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
<div id="popup-congrats" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); z-index:9999; text-align:center;">
<img alt="M·∫π Qu·ª≥nh" src="images/me_quynh.jpg" style="width:250px; border-radius:10px; box-shadow: 0 0 10px #888;"/>
<div id="popup-text" style="background:white; padding:10px; font-weight:bold; font-size:18px; margin-top:-5px;">B√© l√†m t·ªët l·∫Øm!</div>
</div>
<audio id="audio-congrats" preload="auto" src=""></audio>
<img id="watering-gif" src="images/water.gif" style="display:none; position:absolute; width:120px; top:350px; left:1190px; z-index:10;"/>

<!-- TH√äM ƒêO·∫†N N√ÄY -->
<div style="position: fixed; bottom: 500px; right: 340px; text-align: center; z-index: 50;">
    <img id="tree-img" src="images/tree_day1.png" style="width:150px; height:150px;">
    <div id="tree-status" style="font-weight:bold; color:#FF9800; margin:5px 0;">
        C√¢y c·∫ßn n∆∞·ªõc ƒë·ªÉ ph√°t tri·ªÉn!
    </div>
    <div style="margin-top:5px; margin-bottom:10px;">
        <span id="water-count" style="font-weight:bold; color:#2196F3;">üíß <span id="water-units">0</span> l∆∞·ª£t t∆∞·ªõi</span>
    </div>
    <button onclick="waterTree()">üíß B√© t∆∞·ªõi n∆∞·ªõc cho c√¢y</button>
</div>

<!-- Th√™m khu v·ª±c hi·ªÉn th·ªã huy hi·ªáu -->
<div style="position: fixed; top: 100px; right: 20px; text-align: center; background-color: rgba(255,255,255,0.8); padding: 10px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h3 style="margin-top: 0; color: #FF6D00;">Huy hi·ªáu c·ªßa b√©</h3>
    <div id="badges-container" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; max-width: 150px;">
        <!-- Huy hi·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
    </div>
</div>
<script>
// ƒê·ªãnh nghƒ©a c√°c lo·∫°i huy hi·ªáu
const badges = [
    { id: 'star3', name: '3 Ng√†y Sao V√†ng', image: '‚≠ê‚≠ê‚≠ê', condition: 'Ho√†n th√†nh t·ªët 3 ng√†y li√™n ti·∫øp' },
    { id: 'sleep7', name: 'Ng·ªß Ngoan 7 Ng√†y', image: 'üò¥ü•á', condition: 'ƒêi ng·ªß ƒë√∫ng gi·ªù 7 ng√†y li√™n ti·∫øp' },
    { id: 'tree', name: 'Ng∆∞·ªùi Tr·ªìng C√¢y', image: 'üå≥üëë', condition: 'C√¢y ph√°t tri·ªÉn ƒë·∫ßy ƒë·ªß' },
    { id: 'eat5', name: 'ƒÇn Gi·ªèi 5 Ng√†y', image: 'üçΩÔ∏èüèÜ', condition: 'ƒÇn t·ªëi ngoan 5 ng√†y li√™n ti·∫øp' }
];

// H√†m ki·ªÉm tra v√† c·∫•p huy hi·ªáu m·ªõi
function checkAndAwardBadges() {
    // L·∫•y danh s√°ch huy hi·ªáu ƒë√£ c√≥
    let earnedBadges = JSON.parse(localStorage.getItem('earnedBadges') || '{}');
    
    // Ki·ªÉm tra ƒëi·ªÅu ki·ªán c·∫•p huy hi·ªáu m·ªõi
    
    // V√≠ d·ª•: Huy hi·ªáu 3 ng√†y sao v√†ng
    let consecutiveGoodDays = 0;
    for (let i = 0; i < 3; i++) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateKey = getDateKey(date);
        
        if (scheduleData[currentChild][dateKey] && scheduleData[currentChild][dateKey].totalPoints >= 15) {
            consecutiveGoodDays++;
        } else {
            break;
        }
    }
    
    if (consecutiveGoodDays >= 3 && !earnedBadges['star3']) {
        // C·∫•p huy hi·ªáu m·ªõi
        earnedBadges['star3'] = {
            dateAwarded: new Date().toISOString(),
            forChild: currentChild
        };
        
        // Hi·ªáu ·ª©ng th√¥ng b√°o huy hi·ªáu m·ªõi
        showBadgeAward('star3');
    }
    
    // L∆∞u danh s√°ch huy hi·ªáu
    localStorage.setItem('earnedBadges', JSON.stringify(earnedBadges));
    
    // C·∫≠p nh·∫≠t hi·ªÉn th·ªã huy hi·ªáu
    renderBadges();
}

// Hi·ªáu ·ª©ng hi·ªÉn th·ªã huy hi·ªáu m·ªõi
function showBadgeAward(badgeId) {
    const badge = badges.find(b => b.id === badgeId);
    if (!badge) return;
    
    // T·∫°o ph·∫ßn t·ª≠ th√¥ng b√°o
    const notification = document.createElement('div');
    notification.style.position = 'fixed';
    notification.style.top = '50%';
    notification.style.left = '50%';
    notification.style.transform = 'translate(-50%, -50%)';
    notification.style.background = 'linear-gradient(45deg, #FF9800, #FF5722)';
    notification.style.color = 'white';
    notification.style.padding = '20px';
    notification.style.borderRadius = '15px';
    notification.style.boxShadow = '0 5px 30px rgba(0,0,0,0.3)';
    notification.style.textAlign = 'center';
    notification.style.zIndex = '10000';
    notification.style.fontSize = '24px';
    notification.style.animation = 'badgeWiggle 1s infinite';
    
    // Th√™m style animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes badgeWiggle {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
            100% { transform: translate(-50%, -50%) rotate(0deg); }
        }
        
        @keyframes badgeFade {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
        }
    `;
    document.head.appendChild(style);
    
    // N·ªôi dung th√¥ng b√°o
    notification.innerHTML = `
        <div style="font-size: 72px; margin-bottom: 10px;">${badge.image}</div>
        <div style="font-weight: bold; margin-bottom: 10px;">üéâ CH√öC M·ª™NG B√â! üéâ</div>
        <div>B√© ƒë√£ ƒë·∫°t ƒë∆∞·ª£c huy hi·ªáu m·ªõi:</div>
        <div style="font-weight: bold; font-size: 28px; margin: 10px 0;">${badge.name}</div>
        <div>${badge.condition}</div>
        <button style="margin-top: 20px; padding: 10px 20px; background: white; color: #FF5722; border: none; border-radius: 30px; font-weight: bold; cursor: pointer;">C·∫£m ∆°n</button>
    `;
    
    // Th√™m v√†o body
    document.body.appendChild(notification);
    
    // X·ª≠ l√Ω s·ª± ki·ªán n√∫t ƒë√≥ng
    notification.querySelector('button').addEventListener('click', () => {
        notification.style.animation = 'badgeFade 0.5s forwards';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 500);
    });
    
    // T·ª± ƒë·ªông ƒë√≥ng sau 10 gi√¢y
    setTimeout(() => {
        if (document.body.contains(notification)) {
            notification.style.animation = 'badgeFade 0.5s forwards';
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 500);
        }
    }, 10000);
    
    // Ph√°t √¢m thanh vui nh·ªôn
    const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/218/218-preview.mp3');
    audio.play().catch(e => console.warn("Kh√¥ng th·ªÉ ph√°t √¢m thanh:", e));
}
// Th√™m v√†o ph·∫ßn ƒë·∫ßu script
let childLevel = {
    tridung: 1,
    thaoVy: 1
};

// Ki·ªÉm tra v√† n√¢ng c·∫•p
function checkAndUpgradeLevel() {
    // ƒê·ªçc d·ªØ li·ªáu c·∫•p ƒë·ªô t·ª´ localStorage n·∫øu c√≥
    const savedLevels = localStorage.getItem('childLevels');
    if (savedLevels) {
        childLevel = JSON.parse(savedLevels);
    }
    
    // T√≠nh t·ªïng ƒëi·ªÉm c·ªßa 7 ng√†y g·∫ßn nh·∫•t
    let weeklyPoints = 0;
    for (let i = 0; i < 7; i++) {
        const date = new Date(currentDate);
        date.setDate(date.getDate() - i);
        const dateKey = getDateKey(date);
        
        if (scheduleData[currentChild][dateKey] && scheduleData[currentChild][dateKey].totalPoints) {
            weeklyPoints += scheduleData[currentChild][dateKey].totalPoints;
        }
    }
    
    // T√≠nh c·∫•p ƒë·ªô m·ªõi d·ª±a tr√™n t·ªïng ƒëi·ªÉm
    const newLevel = Math.floor(weeklyPoints / 30) + 1;
    
    // N·∫øu c·∫•p ƒë·ªô tƒÉng
    if (newLevel > childLevel[currentChild]) {
        // C·∫≠p nh·∫≠t c·∫•p ƒë·ªô
        const oldLevel = childLevel[currentChild];
        childLevel[currentChild] = newLevel;
        
        // L∆∞u v√†o localStorage
        localStorage.setItem('childLevels', JSON.stringify(childLevel));
        
        // Hi·ªÉn th·ªã th√¥ng b√°o n√¢ng c·∫•p
        showLevelUpNotification(oldLevel, newLevel);
        
        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
        updateLevelDisplay();
    }
}

// Hi·ªÉn th·ªã th√¥ng b√°o n√¢ng c·∫•p
function showLevelUpNotification(oldLevel, newLevel) {
    // T·∫°o ph·∫ßn t·ª≠ th√¥ng b√°o
    const notification = document.createElement('div');
    notification.style.position = 'fixed';
    notification.style.top = '50%';
    notification.style.left = '50%';
    notification.style.transform = 'translate(-50%, -50%)';
    notification.style.background = 'linear-gradient(45deg, #4CAF50, #8BC34A)';
    notification.style.color = 'white';
    notification.style.padding = '20px';
    notification.style.borderRadius = '15px';
    notification.style.boxShadow = '0 5px 30px rgba(0,0,0,0.3)';
    notification.style.textAlign = 'center';
    notification.style.zIndex = '10000';
    
    // N·ªôi dung th√¥ng b√°o
    notification.innerHTML = `
        <div style="font-size: 72px; margin-bottom: 10px;">üéâ</div>
        <div style="font-weight: bold; margin-bottom: 10px;">CH√öC M·ª™NG B√â!</div>
        <div>B√© ƒë√£ l√™n c·∫•p!</div>
        <div style="display: flex; align-items: center; justify-content: center; margin: 20px 0;">
            <div style="font-size: 24px; margin-right: 20px;">C·∫•p ${oldLevel}</div>
            <div style="font-size: 24px;">‚û°Ô∏è</div>
            <div style="font-size: 36px; font-weight: bold; margin-left: 20px;">C·∫•p ${newLevel}</div>
        </div>
        <div>H√£y ti·∫øp t·ª•c c·ªë g·∫Øng nh√©!</div>
        <button style="margin-top: 20px; padding: 10px 20px; background: white; color: #4CAF50; border: none; border-radius: 30px; font-weight: bold; cursor: pointer;">C·∫£m ∆°n</button>
    `;
    
    // Th√™m v√†o body
    document.body.appendChild(notification);
    
    // X·ª≠ l√Ω s·ª± ki·ªán n√∫t ƒë√≥ng
    notification.querySelector('button').addEventListener('click', () => {
        document.body.removeChild(notification);
    });
    
    // Ph√°t √¢m thanh ch√∫c m·ª´ng
    const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/220/220-preview.mp3');
    audio.play().catch(e => console.warn("Kh√¥ng th·ªÉ ph√°t √¢m thanh:", e));
    
    // Hi·ªáu ·ª©ng ph√°o hoa
    createFireworks();
}

// C·∫≠p nh·∫≠t hi·ªÉn th·ªã c·∫•p ƒë·ªô
function updateLevelDisplay() {
    // Ki·ªÉm tra n·∫øu ph·∫ßn t·ª≠ hi·ªÉn th·ªã c·∫•p ƒë·ªô ch∆∞a t·ªìn t·∫°i, t·∫°o m·ªõi
    if (!document.getElementById('child-level-display')) {
        const levelDisplay = document.createElement('div');
        levelDisplay.id = 'child-level-display';
        levelDisplay.style.position = 'fixed';
        levelDisplay.style.top = '70px';
        levelDisplay.style.left = '20px';
        levelDisplay.style.background = 'linear-gradient(45deg, #673AB7, #3F51B5)';
        levelDisplay.style.color = 'white';
        levelDisplay.style.padding = '5px 15px';
        levelDisplay.style.borderRadius = '20px';
        levelDisplay.style.fontWeight = 'bold';
        levelDisplay.style.zIndex = '999';
        document.body.appendChild(levelDisplay);
    }
    
    // C·∫≠p nh·∫≠t n·ªôi dung
    const levelDisplay = document.getElementById('child-level-display');
    levelDisplay.innerHTML = `${currentChild === 'tridung' ? 'Tr√≠ D≈©ng' : 'Th·∫£o Vy'} - C·∫•p ${childLevel[currentChild]}`;
}
// Hi·ªÉn th·ªã huy hi·ªáu ƒë√£ ƒë·∫°t ƒë∆∞·ª£c
function renderBadges() {
    const container = document.getElementById('badges-container');
    container.innerHTML = '';
    
    const earnedBadges = JSON.parse(localStorage.getItem('earnedBadges') || '{}');
    
    // L·ªçc huy hi·ªáu c·ªßa b√© hi·ªán t·∫°i
    const childBadges = Object.keys(earnedBadges)
        .filter(badgeId => earnedBadges[badgeId].forChild === currentChild)
        .map(badgeId => badges.find(b => b.id === badgeId))
        .filter(badge => !!badge);
    
    if (childBadges.length === 0) {
        container.innerHTML = '<div style="color: #757575; font-style: italic;">B√© ch∆∞a c√≥ huy hi·ªáu n√†o</div>';
        return;
    }
    
    // Hi·ªÉn th·ªã huy hi·ªáu
    childBadges.forEach(badge => {
        const badgeElement = document.createElement('div');
        badgeElement.style.fontSize = '24px';
        badgeElement.style.cursor = 'pointer';
        badgeElement.title = `${badge.name}: ${badge.condition}`;
        badgeElement.innerHTML = badge.image;
        
        badgeElement.addEventListener('click', () => {
            alert(`Huy hi·ªáu: ${badge.name}\n${badge.condition}`);
        });
        
        container.appendChild(badgeElement);
    });
}
// ƒê√°nh gi√° nhi·ªám v·ª•





// T·∫°o hi·ªáu ·ª©ng confetti nh·ªè
function createSmallConfetti(element) {
    const rect = element.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    for (let i = 0; i < 30; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.width = '8px';
        confetti.style.height = '8px';
        confetti.style.backgroundColor = getRandomColor();
        confetti.style.left = `${centerX}px`;
        confetti.style.top = `${centerY}px`;
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.opacity = '1';
        confetti.style.zIndex = '9999';
        confetti.style.pointerEvents = 'none';
        document.body.appendChild(confetti);

        const angle = Math.random() * Math.PI * 2;
        const distance = 20 + Math.random() * 80;
        const duration = 0.5 + Math.random() * 1;

        confetti.style.transition = `transform ${duration}s ease-out, opacity ${duration}s ease-out`;

        setTimeout(() => {
            confetti.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) rotate(${Math.random() * 360}deg)`;
            confetti.style.opacity = '0';
        }, 10);

        setTimeout(() => {
            if (document.body.contains(confetti)) {
                document.body.removeChild(confetti);
            }
        }, duration * 1000);
    }
}

// C·∫≠p nh·∫≠t h√†m loadData
const originalLoadData = loadData;
loadData = function() {
    originalLoadData();
    // Hi·ªÉn th·ªã c·∫•p ƒë·ªô sau khi t·∫£i d·ªØ li·ªáu
    updateLevelDisplay();
    // Hi·ªÉn th·ªã huy hi·ªáu
    renderBadges();
};


// C·∫≠p nh·∫≠t h√†m rateTask
function rateTask(childName, taskId, rating) {
    const now = new Date();
    const today = getDateKey(now);
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();

    const displayedDate = getDateKey(currentDate);
   // T·∫°o key duy nh·∫•t cho m·ªói nhi·ªám v·ª• trong ng√†y
   //const taskWaterKey = `${dateKey}_${childName}_${taskId}`;
    //const taskWater = scheduleData[childName][dateKey].tasks.find(t => t.id === taskId);
   // if (!taskWater) return;
    // Ki·ªÉm tra ng√†y t∆∞∆°ng lai
    if (new Date(displayedDate) > new Date(today)) {
        alert("Kh√¥ng th·ªÉ ƒë√°nh gi√° nhi·ªám v·ª• c·ªßa ng√†y trong t∆∞∆°ng lai!");
        return;
    }

    // Ki·ªÉm tra m·∫≠t kh·∫©u TR∆Ø·ªöC KHI th·ª±c hi·ªán b·∫•t k·ª≥ h√†nh ƒë·ªông n√†o
    const pin = prompt("Nh·∫≠p m√£ PIN ƒë·ªÉ x√°c nh·∫≠n (m·∫∑c ƒë·ªãnh: 1234):");
    if (pin !== "1234") {
        alert("M√£ PIN kh√¥ng ƒë√∫ng!");
        return;
    }

    // Ch·ªâ th·ª±c hi·ªán c√°c h√†nh ƒë·ªông sau khi m√£ PIN ƒë√∫ng
    const dateKey = getDateKey(currentDate);
    const task = scheduleData[childName][dateKey]?.tasks.find(t => t.id === taskId);
    if (!task) return;

    task.rating = rating;
    recalculateTotalPoints(childName, dateKey);

    // X·ª≠ l√Ω khi ƒë√°nh gi√° t·ªët
    if (rating === 'good') {
        const taskTemplate = taskTemplates[childName].find(t => t.id === taskId);
        if (taskTemplate) {
            // Th·ª© t·ª±: ph√°o hoa -> √¢m thanh m·∫π Qu·ª≥nh -> tƒÉng n∆∞·ªõc
            createFireworks();
            
            // ƒê·ª£i ph√°o hoa xong m·ªõi ph√°t √¢m thanh v√† tƒÉng n∆∞·ªõc
            setTimeout(() => {
                playCongrats(taskTemplate.name.toLowerCase());
                addWater(1);
            }, 4000);
        }
    }

    // C·∫≠p nh·∫≠t giao di·ªán v√† ki·ªÉm tra th√†nh t√≠ch
    renderTasks();
    updateProgress();
    checkReward();
    checkAndUpgradeLevel();
    checkAndAwardBadges();
    saveData();
}

// QUAN TR·ªåNG: X√≥a ho√†n to√†n ƒëo·∫°n code n√†y ·ªü cu·ªëi file
// X√≥a ƒëo·∫°n:
/*
const originalRateTask = rateTask;
rateTask = function(childName, taskId, rating) {
    ...
};
*/
function createFireworks() {
    const fireworksContainer = document.createElement('div');
    fireworksContainer.style.position = 'fixed';
    fireworksContainer.style.top = '0';
    fireworksContainer.style.left = '0';
    fireworksContainer.style.width = '100%';
    fireworksContainer.style.height = '100%';
    fireworksContainer.style.pointerEvents = 'none';
    fireworksContainer.style.zIndex = '999';
    document.body.appendChild(fireworksContainer);

    // T·∫°o √¢m thanh ph√°o hoa
    const audio = document.getElementById("audio-congrats");
    audio.src = "audio/firework.mp3";
    audio.play().catch(e => console.warn("Kh√¥ng th·ªÉ ph√°t √¢m thanh:", e));

    // TƒÉng s·ªë l∆∞·ª£ng ph√°o hoa v√† th·ªùi gian hi·ªÉn th·ªã
    const totalFireworks = 15; // TƒÉng t·ª´ 5 l√™n 15
    const duration = 8000; // TƒÉng t·ª´ 6000 l√™n 8000ms

    // T·∫°o ph√°o hoa v·ªõi t·∫ßn su·∫•t cao h∆°n
    for (let i = 0; i < totalFireworks; i++) {
        setTimeout(() => {
            createLargeFirework(fireworksContainer);
        }, i * 400); // Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c qu·∫£ ph√°o t·ª´ 800 xu·ªëng 400ms
    }

    setTimeout(() => {
        document.body.removeChild(fireworksContainer);
    }, duration);
}

function createLargeFirework(container) {
    const startX = window.innerWidth / 2;
    const startY = window.innerHeight;

    // TƒÉng ph·∫°m vi n·ªï
    const explodeX = startX + (Math.random() * 400 - 200); // TƒÉng t·ª´ 200 l√™n 400
    const explodeY = window.innerHeight * (0.2 + Math.random() * 0.4); // N·ªï t·ª´ 20% ƒë·∫øn 60% chi·ªÅu cao m√†n h√¨nh

    const firework = document.createElement('div');
    firework.style.position = 'absolute';
    firework.style.width = '20px'; // TƒÉng k√≠ch th∆∞·ªõc t·ª´ 15px l√™n 20px
    firework.style.height = '20px';
    firework.style.borderRadius = '50%';
    firework.style.backgroundColor = getRandomColor();
    firework.style.boxShadow = `0 0 15px ${getRandomColor()}`; // TƒÉng ƒë·ªô s√°ng
    firework.style.left = `${startX}px`;
    firework.style.top = `${startY}px`;
    firework.style.transition = `transform 1s ease-out, opacity 1s ease-out`;
    container.appendChild(firework);

    setTimeout(() => {
        firework.style.transform = `translate(${explodeX - startX}px, ${explodeY - startY}px)`;

        setTimeout(() => {
            firework.style.opacity = '0';

            // TƒÉng s·ªë l∆∞·ª£ng tia v√† k√≠ch th∆∞·ªõc
            const numParticles = 120; // TƒÉng t·ª´ 80 l√™n 120
            for (let i = 0; i < numParticles; i++) {
                const angle = (i / numParticles) * 2 * Math.PI;
                const distance = 200 + Math.random() * 200; // TƒÉng kho·∫£ng c√°ch b·∫Øn
                const duration = 2.5 + Math.random() * 1.5; // TƒÉng th·ªùi gian bay

                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '10px'; // TƒÉng k√≠ch th∆∞·ªõc tia
                particle.style.height = '10px';
                particle.style.backgroundColor = getRandomColor();
                particle.style.boxShadow = `0 0 8px ${getRandomColor()}`; // TƒÉng ƒë·ªô s√°ng
                particle.style.opacity = '1';
                particle.style.borderRadius = '50%';
                particle.style.left = `${explodeX}px`;
                particle.style.top = `${explodeY}px`;
                particle.style.transition = `transform ${duration}s ease-out, opacity ${duration}s ease-out`;
                container.appendChild(particle);

                setTimeout(() => {
                    particle.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
                    particle.style.opacity = '0';
                }, 10);

                setTimeout(() => {
                    if (document.body.contains(particle)) {
                        container.removeChild(particle);
                    }
                }, duration * 1000);
            }
        }, 1000);
    }, 10);
}
function getRandomColor() {
    const colors = [
        '#ff0000', '#ffa500', '#ffff00', '#00ff00', '#00ffff', 
        '#0000ff', '#ff00ff', '#ff69b4', '#00ff7f', '#ff4500'
    ];
    return colors[Math.floor(Math.random() * colors.length)];
}

function checkAndResetTree() {
    const today = new Date();
    const dayOfWeek = today.getDay(); // 0 = Ch·ªß nh·∫≠t, 1 = Th·ª© 2, ...

    // Ki·ªÉm tra xem c√≥ ph·∫£i l√† th·ª© 2 kh√¥ng
    if (dayOfWeek === 1) {
        // L·∫•y ng√†y cu·ªëi c√πng reset c√¢y t·ª´ localStorage
        const lastResetDate = localStorage.getItem('lastTreeReset');
        const today = new Date().toDateString();

        // N·∫øu ch∆∞a reset h√¥m nay
        if (lastResetDate !== today) {
            // Reset c√¢y v·ªÅ c·∫•p 1
            treeLevel = 1;
            document.getElementById("tree-img").src = "images/tree_day1.png";
            document.getElementById("tree-status").textContent = "C√¢y ƒë√£ reset! H√£y chƒÉm s√≥c c√¢y t·ª´ ƒë·∫ßu nh√©!";
            document.getElementById("tree-status").style.color = "#FF9800";

            // L∆∞u ng√†y ƒë√£ reset
            localStorage.setItem('lastTreeReset', today);
            
            // L∆∞u tr·∫°ng th√°i c√¢y
            saveData();
            
            // Th√¥ng b√°o cho ng∆∞·ªùi d√πng
            alert("ƒê√£ sang tu·∫ßn m·ªõi! C√¢y ƒë√£ ƒë∆∞·ª£c reset v·ªÅ c·∫•p 1.");
        }
    }
}
function createSingleFirework(container) {
    // V·ªã tr√≠ xu·∫•t ph√°t
    const startX = Math.random() * window.innerWidth;
    const startY = window.innerHeight;

    // V·ªã tr√≠ n·ªï
    const explodeX = startX + (Math.random() * 200 - 100);
    const explodeY = 100 + Math.random() * (window.innerHeight / 2);

    // T·∫°o ph√°o hoa
    const firework = document.createElement('div');
    firework.style.position = 'absolute';
    firework.style.width = '8px';
    firework.style.height = '8px';
    firework.style.borderRadius = '50%';
    firework.style.backgroundColor = getRandomColor();
    firework.style.left = `${startX}px`;
    firework.style.top = `${startY}px`;
    firework.style.transition = `transform 1.5s ease-out, opacity 1.5s ease-out`;
    container.appendChild(firework);

    // Bay l√™n v√† n·ªï
    setTimeout(() => {
        firework.style.transform = `translate(${explodeX - startX}px, ${explodeY - startY}px)`;

        // N·ªï th√†nh nhi·ªÅu tia nh·ªè
        setTimeout(() => {
            firework.style.opacity = '0';

            // T·∫°o c√°c tia nh·ªè
            const numParticles = 50;
            for (let i = 0; i < numParticles; i++) {
                const angle = (i / numParticles) * 2 * Math.PI;
                const distance = 100 + Math.random() * 100;
                const duration = 1.5 + Math.random() * 0.5;

                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '5px';
                particle.style.height = '5px';
                particle.style.backgroundColor = getRandomColor();
                particle.style.opacity = '1';
                particle.style.borderRadius = '50%';
                particle.style.left = `${explodeX}px`;
                particle.style.top = `${explodeY}px`;
                particle.style.transition = `transform ${duration}s ease-out, opacity ${duration}s ease-out`;
                container.appendChild(particle);

                // B·∫Øn t·ªèa ra
                setTimeout(() => {
                    particle.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
                    particle.style.opacity = '0';
                }, 10);

                // X√≥a tia sau khi ho√†n th√†nh
                setTimeout(() => {
                    if (document.body.contains(particle)) {
                        container.removeChild(particle);
                    }
                }, duration * 1000);
            }
        }, 1500);
    }, 10);
}
function playCongrats(taskName) {
  const messages = {
    "ƒÉn t·ªëi t·∫°i nh√†": "audio/an_toi_tai_nha.mp3",
    "v·ªá sinh c√° nh√¢n bu·ªïi t·ªëi": "audio/ve_sinh_ca_nhan_buoi_toi.mp3",
    "ƒë·ªçc s√°ch, t√¥ m√†u ho·∫∑c l√†m to√°n": "audio/doc_sach_to_mau_hoac_lam_toan.mp3",
    "ƒëi ng·ªß": "audio/di_ngu.mp3",
    "th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n, ƒëi h·ªçc": "audio/thuc_day_ve_sinh_ca_nhan_di_hoc.mp3",
    "ch∆°i t·ª± do": "audio/choi_tu_do.mp3",
    "v·ªá sinh c√° nh√¢n s√°ng": "audio/ve_sinh_ca_nhan_sang.mp3",
    "ng·ªß ƒë√™m qua": "audio/ngu_dem_qua.mp3",
    "ph√°o hoa": "audio/firework.mp3"
  };

  const audio = document.getElementById("audio-congrats");
  const popup = document.getElementById("popup-congrats");
  const popupText = document.getElementById("popup-text");

  audio.src = messages[taskName] || "";
  popupText.innerText = "Ch√∫c m·ª´ng anh V√≠t ho√†n th√†nh t·ªët nhi·ªám v·ª•: " + taskName;
  popup.style.display = "block";
  if (audio.src) {
    audio.play().catch(e => console.warn("Kh√¥ng th·ªÉ ph√°t audio:", e));
  }

  setTimeout(() => {
    popup.style.display = "none";
  }, 4500);
}
// C·∫≠p nh·∫≠t h√¨nh ·∫£nh c√¢y theo ng√†y trong tu·∫ßn


// Bi·∫øn theo d√µi tr·∫°ng th√°i c√¢y v√† n∆∞·ªõc
let waterCredits = 0;       // S·ªë l∆∞·ª£t t∆∞·ªõi
let treeLevel = 1;          // C·∫•p ƒë·ªô c√¢y (1-7)
let currentWeekDay = 0;     // Ng√†y trong tu·∫ßn (0: Ch·ªß Nh·∫≠t, 1: Th·ª© 2...)
let waterReceivedTasks = {};
// S·ª≠a h√†m addWater ƒë·ªÉ tƒÉng s·ªë l∆∞·ª£t t∆∞·ªõi
// S·ª≠a h√†m addWater
function addWater(units) {
    // TƒÉng s·ªë l∆∞·ª£t t∆∞·ªõi
    waterCredits += units;
    
    // C·∫≠p nh·∫≠t UI ngay l·∫≠p t·ª©c
    document.getElementById("water-units").textContent = waterCredits;
    
    // Hi·ªÉn th·ªã th√¥ng b√°o
    const waterNotification = document.createElement("div");
    waterNotification.style.position = "fixed";
    waterNotification.style.bottom = "10px";
    waterNotification.style.left = "50%";
    waterNotification.style.transform = "translateX(-50%)";
    waterNotification.style.backgroundColor = "#2196F3";
    waterNotification.style.color = "white";
    waterNotification.style.padding = "10px 20px";
    waterNotification.style.borderRadius = "5px";
    waterNotification.style.zIndex = "9999";
    waterNotification.innerHTML = `<i class="fas fa-plus"></i> ƒê√£ th√™m ${units} l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc!`;
    
    document.body.appendChild(waterNotification);
    
    setTimeout(() => {
        waterNotification.style.opacity = "0";
        waterNotification.style.transition = "opacity 0.5s";
        setTimeout(() => {
            document.body.removeChild(waterNotification);
        }, 500);
    }, 2000);
    
    // L∆∞u d·ªØ li·ªáu
    saveData();
    
    console.log("ƒê√£ th√™m", units, "l∆∞·ª£t t∆∞·ªõi, hi·ªán c√≥:", waterCredits);
}
// C·∫≠p nh·∫≠t h√†m rateTask
/*
const originalRateTask = rateTask;
rateTask = function(childName, taskId, rating) {
    // G·ªçi h√†m g·ªëc
    originalRateTask(childName, taskId, rating);

    // N·∫øu ƒë√°nh gi√° t·ªët, t·∫°o hi·ªáu ·ª©ng
    if (rating === 'good') {
        const taskTemplate = taskTemplates[childName].find(t => t.id === taskId);
        if (taskTemplate) {
           playCongrats(taskTemplate.name.toLowerCase());
            addWater(1);
        }
        createFireworks(); // G·ªçi hi·ªáu ·ª©ng ph√°o hoa
    }

    // Ki·ªÉm tra v√† n√¢ng c·∫•p
    checkAndUpgradeLevel();
    // Ki·ªÉm tra v√† c·∫•p huy hi·ªáu
    checkAndAwardBadges();
};
*/
// S·ª≠a h√†m waterTree() ƒë·ªÉ debug
function waterTree() {
    console.log("ƒêang t∆∞·ªõi c√¢y, s·ªë l∆∞·ª£t hi·ªán t·∫°i:", waterCredits);
    
    // Debug th√¥ng b√°o
    if (waterCredits <= 0) {
        alert("Kh√¥ng ƒë·ªß l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc! H√£y ho√†n th√†nh nhi·ªám v·ª• t·ªët ƒë·ªÉ c√≥ th√™m l∆∞·ª£t t∆∞·ªõi.");
        return;
    }
    
    // Gi·∫£m s·ªë l∆∞·ª£t t∆∞·ªõi v√† c·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c
    waterCredits--;
    document.getElementById("water-units").textContent = waterCredits;
    
    // Hi·ªÉn th·ªã hi·ªáu ·ª©ng t∆∞·ªõi n∆∞·ªõc
    const wateringGif = document.getElementById("watering-gif");
    wateringGif.style.display = "block";
    
    // C·∫≠p nh·∫≠t c·∫•p ƒë·ªô c√¢y
    treeLevel = Math.min(treeLevel + 1, 7);
    
    // C·∫≠p nh·∫≠t h√¨nh ·∫£nh c√¢y sau 1.5 gi√¢y
    setTimeout(() => {
        document.getElementById("tree-img").src = `images/tree_day${treeLevel}.png`;
        wateringGif.style.display = "none";
        
        // Th√¥ng b√°o cho ng∆∞·ªùi d√πng bi·∫øt c√¢y ƒë√£ tƒÉng c·∫•p
        document.getElementById("tree-status").textContent = "C√¢y ƒë√£ ph√°t tri·ªÉn!";
        document.getElementById("tree-status").style.color = "#4CAF50";
        
        // L∆∞u d·ªØ li·ªáu
        saveData();
    }, 1500);
}

</script>
</body>
</html>