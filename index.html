<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Th·ªùi gian bi·ªÉu cho b√©</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&display=swap" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
    <link href="css/main.css" rel="stylesheet"/>
    
    <!-- Th√™m CSS cho profile, c√¢y v√† c√°c ph·∫ßn thi·∫øu -->
    <style>
        :root {
            --primary-color: #FF7043;
            --accent-color: #4CAF50;
            --bg-color: #2D2424;
            --task-bg: #1E1919;
            --text-color: #ffffff;
            --btn-good: #1B4332;
            --btn-neutral: #8B7355;
            --btn-bad: #7B1818;
            --highlight-color: #FFEB3B;
        }

        body {
            background-image: linear-gradient(45deg, #2D2424, #362828);
            animation: gradientShift 10s infinite alternate;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        /* CSS cho th·ª≠ th√°ch tu·∫ßn m·ªõi */
        .weekly-challenge-container {
            background: linear-gradient(135deg, #6200ea, #3f51b5);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            border-left: 5px solid #FFEB3B;
            animation: pulse 2s infinite alternate;
        }

        .weekly-challenge-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            opacity: 0.5;
            animation: shineBg 3s infinite linear;
            pointer-events: none;
        }

        @keyframes shineBg {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
            100% { box-shadow: 0 4px 20px rgba(98,0,234,0.6); }
        }

        .weekly-challenge-container h3 {
            color: #FFEB3B;
            font-size: 1.4em;
            margin-top: 0;
            position: relative;
            display: inline-block;
        }

        .weekly-challenge-container h3::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.5);
        }

        .challenge-description {
            font-size: 1.1em;
            margin: 15px 0;
            font-weight: 500;
        }

        .progress-bar {
            height: 10px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFEB3B, #FFC107);
            border-radius: 10px;
            width: 0%;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        #challenge-progress-text {
            font-weight: bold;
            color: white;
            font-size: 1.1em;
            margin: 5px 0;
        }

        .challenge-reward {
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: inline-block;
        }

        #reward-icon {
            font-size: 1.5em;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-5px); }
        }

        /* CSS cho n√∫t ƒë√°nh gi√° tr√™n mobile - 1 h√†ng */
        @media screen and (max-width: 768px) {
            .rating-buttons {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                gap: 8px;
                margin-top: 15px;
            }

            .rating-btn {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 12px 5px;
                font-size: 13px;
                text-align: center;
                border-radius: 10px;
                min-height: 60px;
                transition: transform 0.2s, box-shadow 0.2s;
            }
            
            .rating-btn i {
                font-size: 20px;
                margin-bottom: 5px;
            }
            
            .rating-btn.active {
                transform: scale(1.05);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            }
            
            .good-btn {
                background: linear-gradient(145deg, #1B4332, #2E7D32);
            }
            
            .neutral-btn {
                background: linear-gradient(145deg, #8B7355, #A1887F);
            }
            
            .bad-btn {
                background: linear-gradient(145deg, #7B1818, #B71C1C);
            }

            /* ƒêi·ªÅu ch·ªânh kho·∫£ng c√°ch gi·ªØa c√¢y v√† n√∫t */
            .tree-container {
                margin-top: 30px;
                margin-bottom: 30px;
            }
            
            /* C·∫£i thi·ªán hi·ªÉn th·ªã animation t∆∞·ªõi n∆∞·ªõc */
            #watering-gif {
                top: 40%;
            }
        }

        /* CSS cho c√¢y v√† animation */
        .tree-container {
            position: relative;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .tree-image {
            width: 180px;
            height: 180px;
            transition: all 0.3s ease;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }

        .tree-growth {
            animation: treeGrow 1s ease-out;
        }

        @keyframes treeGrow {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.3); }
            100% { transform: scale(1); filter: brightness(1); }
        }

        /* CSS cho n√∫t t∆∞·ªõi n∆∞·ªõc */
        .water-button {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1976D2, #03A9F4);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: waterPulse 1.5s infinite alternate;
        }

        .water-button:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        @keyframes waterPulse {
            0% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.6); }
            70% { box-shadow: 0 0 0 15px rgba(33, 150, 243, 0); }
            100% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0); }
        }
        
        /* CSS cho ph·∫ßn th·ªëng k√™ */
        .stats-container {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #FFEB3B;
        }
        
        .stats-header h3 {
            margin: 0;
            font-size: 1.2em;
        }
        
        .stats-body {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 10px;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .stats-row:last-child {
            border-bottom: none;
        }
        
        .stats-label {
            font-weight: bold;
        }
        
        .stats-value {
            color: var(--primary-color);
        }
        
        .stats-child-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .stats-child-btn {
            flex: 1;
            padding: 8px;
            border: none;
            background: rgba(0,0,0,0.3);
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .stats-child-btn.active {
            background: var(--primary-color);
            font-weight: bold;
        }

        /* CSS cho popup th·ªùi gian t√πy ch·ªânh */
        .time-settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .time-settings-container {
            background: #2D2424;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: scaleIn 0.3s forwards;
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .time-settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .time-settings-header h3 {
            margin: 0;
            color: var(--primary-color);
        }

        .close-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .time-settings-body {
            max-height: 70vh;
            overflow-y: auto;
        }

        .time-item {
            margin-bottom: 15px;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
        }

        .time-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .time-input {
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 5px;
        }

        .save-times-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .save-times-button:hover {
            background: #E65100;
        }
    </style>
</head>
<body>
    <!-- Th√™m profile c·ªßa 2 em -->
    <div class="profile-container" id="tridung-profile">
        <img src="images/vit.jpg" alt="Tr√≠ D≈©ng">
        <div class="profile-info">
            <div class="profile-name">Tr√≠ D≈©ng</div>
            <div class="profile-level">C·∫•p <span id="tridung-level">1</span></div>
            <div class="xp-bar">
                <div class="xp-progress" id="tridung-xp-progress" style="width: 0%"></div>
            </div>
        </div>
        <button onclick="openTimeSettings('tridung')" class="time-settings-button" style="background: none; border: none; color: var(--primary-color); margin-left: auto">
            <i class="fas fa-clock"></i>
        </button>
    </div>

    <div class="profile-container" id="thaoVy-profile" style="display: none;">
        <img src="images/vy.jpg" alt="Th·∫£o Vy">
        <div class="profile-info">
            <div class="profile-name">Th·∫£o Vy</div>
            <div class="profile-level">C·∫•p <span id="thaoVy-level">1</span></div>
            <div class="xp-bar">
                <div class="xp-progress" id="thaoVy-xp-progress" style="width: 0%"></div>
            </div>
        </div>
        <button onclick="openTimeSettings('thaoVy')" class="time-settings-button" style="background: none; border: none; color: var(--primary-color); margin-left: auto">
            <i class="fas fa-clock"></i>
        </button>
    </div>

    <div class="container">
        <div class="header">
            <h1>Th·ªùi gian bi·ªÉu cho b√©</h1>
            <div class="current-time"></div>
        </div>

        <div class="tabs">
            <div class="tab active" data-child="tridung">
                <img src="images/vit.jpg" alt="Tr√≠ D≈©ng">
                Tr√≠ D≈©ng (5 tu·ªïi)
            </div>
            <div class="tab" data-child="thaoVy">
                <img src="images/vy.jpg" alt="Th·∫£o Vy">
                Th·∫£o Vy (3 tu·ªïi)
            </div>
        </div>

        <!-- Th·ª≠ th√°ch tu·∫ßn n√†y - Di chuy·ªÉn l√™n tr√™n -->
        <div class="weekly-challenge-container">
            <h3><i class="fas fa-trophy"></i> Th·ª≠ th√°ch tu·∫ßn n√†y</h3>
            <div class="challenge-description" id="current-challenge">
                Ho√†n th√†nh <strong>3 nhi·ªám v·ª•</strong> ƒêi ng·ªß ƒë√∫ng gi·ªù li√™n ti·∫øp!
            </div>
            <div class="challenge-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="challenge-progress-fill" style="width: 0%"></div>
                </div>
                <div id="challenge-progress-text">0/3</div>
            </div>
            <div class="challenge-reward">
                <span id="reward-icon">üéÅ</span> Ph·∫ßn th∆∞·ªüng: <span id="challenge-reward">2 l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc ƒë·∫∑c bi·ªát!</span>
            </div>
        </div>

        <div id="tridung" class="child-content">
            <div class="task-list"></div>
        </div>

        <div id="thaoVy" class="child-content" style="display: none;">
            <div class="task-list"></div>
        </div>
    
        <!-- Thay th·∫ø ph·∫ßn div c√¢y c≈© b·∫±ng container m·ªõi -->
        <div class="tree-container">
            <img id="tree-img" src="images/tree_day1.png" class="tree-image" alt="C√¢y ph√°t tri·ªÉn">
            <div class="tree-name" id="tree-name">
                C√¢y c·ªßa b√© Tr√≠ D≈©ng
            </div>
            <div id="tree-status" style="font-weight:bold; color:#FFEB3B; margin:5px 0;">
                C√¢y c·∫ßn n∆∞·ªõc ƒë·ªÉ ph√°t tri·ªÉn!
            </div>
            <div style="margin-top:5px;">
                <span style="font-weight:bold;">L∆∞·ª£t t∆∞·ªõi n∆∞·ªõc: <span id="water-units">0</span></span>
            </div>
            <button class="water-button" onclick="waterTree()" title="T∆∞·ªõi n∆∞·ªõc cho c√¢y">
                üíß
            </button>
            <img id="watering-gif" src="images/water.gif" style="display:none; position:absolute; z-index:10;"/>
        </div>
        
        <!-- Th·ªëng k√™ k·∫øt qu·∫£ theo tu·∫ßn -->
        <div class="stats-container">
            <div class="stats-header">
                <h3><i class="fas fa-chart-bar"></i> Th·ªëng k√™ tu·∫ßn n√†y</h3>
                <button onclick="toggleStatsView()" class="stats-view-toggle" style="background: none; border: none; color: white;">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            
            <div class="stats-child-toggle">
                <button class="stats-child-btn active" onclick="switchStatsChild('tridung')">Tr√≠ D≈©ng</button>
                <button class="stats-child-btn" onclick="switchStatsChild('thaoVy')">Th·∫£o Vy</button>
            </div>
            
            <div class="stats-body">
                <div class="stats-row">
                    <div class="stats-label">T·ªët:</div>
                    <div class="stats-value" id="stats-good">0</div>
                </div>
                <div class="stats-row">
                    <div class="stats-label">Ch·∫•p nh·∫≠n ƒë∆∞·ª£c:</div>
                    <div class="stats-value" id="stats-neutral">0</div>
                </div>
                <div class="stats-row">
                    <div class="stats-label">Ch∆∞a t·ªët:</div>
                    <div class="stats-value" id="stats-bad">0</div>
                </div>
                <div class="stats-row">
                    <div class="stats-label">ƒê·ªô tu√¢n th·ªß:</div>
                    <div class="stats-value" id="stats-compliance">0%</div>
                </div>
            </div>
        </div>
    
        <!-- Admin Controls Button -->
        <div id="admin-toggle" title="C√†i ƒë·∫∑t qu·∫£n tr·ªã">‚öôÔ∏è</div>
    
        <!-- Admin Panel -->
        <div id="admin-panel" style="display: none;">
            <div class="admin-header">
                <h4>Qu·∫£n l√Ω h·ªá th·ªëng</h4>
                <button class="btn-close" id="close-admin">√ó</button>
            </div>
            <div class="admin-controls">
                <button class="admin-btn" id="reset-day" onclick="resetTree()">ƒê·∫∑t l·∫°i c√¢y</button>
                <button class="admin-btn" id="add-water" onclick="addWaterCredits(1)">Th√™m 1 l∆∞·ª£t t∆∞·ªõi</button>
                <button class="admin-btn" id="trigger-fireworks" onclick="createFireworks()">Hi·ªáu ·ª©ng ph√°o hoa</button>
                <button class="admin-btn" id="reset-stats" onclick="resetWeeklyStats()">ƒê·∫∑t l·∫°i th·ªëng k√™</button>
            </div>
        </div>
    
        <!-- Popup ch√∫c m·ª´ng -->
        <div id="popup-congrats" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); z-index:9999; text-align:center;">
            <img alt="M·∫π Qu·ª≥nh" src="images/me_quynh.jpg"/>
            <div id="popup-text">B√© l√†m t·ªët l·∫Øm!</div>
        </div>
        
        <!-- Dialog ch·ªânh th·ªùi gian -->
        <div class="time-settings-overlay" id="time-settings">
            <div class="time-settings-container">
                <div class="time-settings-header">
                    <h3>ƒêi·ªÅu ch·ªânh th·ªùi gian</h3>
                    <button class="close-button" onclick="closeTimeSettings()">√ó</button>
                </div>
                <div class="time-settings-body" id="time-settings-body">
                    <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                </div>
                <button class="save-times-button" onclick="saveTimeSettings()">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>

        <audio id="audio-congrats" preload="auto" src=""></audio>
    </div>

    <script>
        // H√†m ph√°t √¢m thanh c·∫£i ti·∫øn
        function playAudio(filename) {
            console.log("ƒêang ph√°t √¢m thanh:", filename);
            const audio = new Audio(`audio/${filename}`);
            
            // Th√™m h√†m x·ª≠ l√Ω l·ªói v√† th√¥ng b√°o
            audio.onloadeddata = function() {
                console.log("√Çm thanh ƒë√£ ƒë∆∞·ª£c t·∫£i:", filename);
            };
            
            audio.onerror = function(e) {
                console.error("L·ªói t·∫£i √¢m thanh:", e);
                alert("Kh√¥ng th·ªÉ ph√°t √¢m thanh. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng ho·∫∑c thi·∫øt b·ªã c·ªßa b·∫°n.");
            };
            
            // Ph√°t √¢m thanh v·ªõi x·ª≠ l√Ω l·ªói
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log("√Çm thanh ƒëang ph√°t:", filename);
                    })
                    .catch(error => {
                        console.warn("Kh√¥ng th·ªÉ ph√°t √¢m thanh:", error);
                        // Th√¥ng b√°o cho ng∆∞·ªùi d√πng bi·∫øt c·∫ßn t∆∞∆°ng t√°c v·ªõi trang
                        if (error.name === "NotAllowedError") {
                            alert("Vui l√≤ng nh·∫•p v√†o b·∫•t k·ª≥ v·ªã tr√≠ n√†o tr√™n trang ƒë·ªÉ cho ph√©p ph√°t √¢m thanh.");
                        }
                    });
            }
            
            return audio;
        }

        // Nhi·ªám v·ª• c·ªßa m·ªói em v·ªõi th·ªùi gian t√πy ch·ªânh
        const tasks = {
            tridung: [
                { id: 'td1', time: '06:00', name: 'Th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n & ƒëi h·ªçc', audio: 'thuc_day_ve_sinh_ca_nhan_di_hoc.mp3' },
                { id: 'td2', time: '17:00', name: 'ƒê·ªçc s√°ch, t√¥ m√†u ho·∫∑c l√†m to√°n', audio: 'doc_sach_to_mau_hoac_lam_toan.mp3' },
                { id: 'td3', time: '18:00', name: 'Ch∆°i t·ª± do', audio: 'choi_tu_do.mp3' },
                { id: 'td4', time: '19:00', name: 'ƒÇn t·ªëi t·∫°i nh√†', audio: 'an_toi_tai_nha.mp3' },
                { id: 'td5', time: '20:00', name: 'V·ªá sinh c√° nh√¢n bu·ªïi t·ªëi', audio: 've_sinh_ca_nhan_buoi_toi.mp3' },
                { id: 'td6', time: '21:00', name: 'ƒêi ng·ªß', audio: 'di_ngu.mp3' }
            ],
            thaoVy: [
                { id: 'tv1', time: '06:00', name: 'Th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n & ƒëi h·ªçc', audio: 'thuc_day_ve_sinh_ca_nhan_di_hoc_thaovy.mp3' },
                { id: 'tv2', time: '17:00', name: 'ƒê·ªçc s√°ch, t√¥ m√†u ho·∫∑c l√†m to√°n', audio: 'doc_sach_to_mau_hoac_lam_toan_thaovy.mp3' },
                { id: 'tv3', time: '18:00', name: 'Ch∆°i t·ª± do', audio: 'choi_tu_do_thaovy.mp3' },
                { id: 'tv4', time: '19:00', name: 'ƒÇn t·ªëi t·∫°i nh√†', audio: 'an_toi_tai_nha_thaovy.mp3' },
                { id: 'tv5', time: '20:00', name: 'V·ªá sinh c√° nh√¢n bu·ªïi t·ªëi', audio: 've_sinh_ca_nhan_buoi_toi_thaovy.mp3' },
                { id: 'tv6', time: '21:00', name: 'ƒêi ng·ªß', audio: 'di_ngu_thaovy.mp3' }
            ]
        };

        // Bi·∫øn cho h·ªá th·ªëng c√¢y ph√°t tri·ªÉn
        let treeLevel = 1;
        let waterCredits = 0;
        let currentChild = 'tridung';
        let currentWeekDay = 0; // 0: Ch·ªß Nh·∫≠t, 1: Th·ª© 2...
        let currentStatsChild = 'tridung';
        
        // Bi·∫øn l∆∞u tr·ªØ th·ªëng k√™ h√†ng tu·∫ßn
        let weeklyStats = {
            tridung: { good: 0, neutral: 0, bad: 0 },
            thaoVy: { good: 0, neutral: 0, bad: 0 }
        };
        
        // H·ªá th·ªëng t√≠nh ƒëi·ªÉm
        const POINTS = {
            good: 3,
            neutral: 1,
            bad: 0
        };

        // ƒê√°nh gi√° nhi·ªám v·ª• v√† c·∫≠p nh·∫≠t th·ªëng k√™
        function rateTask(childName, taskId, rating) {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            // Ki·ªÉm tra m·∫≠t kh·∫©u n·∫øu kh√¥ng ph·∫£i l√† m√¥i tr∆∞·ªùng ph√°t tri·ªÉn
            if (!window.location.hostname.includes('localhost') && !window.location.hostname.includes('127.0.0.1')) {
                const pin = prompt("Nh·∫≠p m√£ PIN ƒë·ªÉ x√°c nh·∫≠n (****)");
                if (pin !== "2022") {
                    alert("M√£ PIN kh√¥ng ƒë√∫ng!");
                    return;
                }
            }
            
            // L∆∞u ƒë√°nh gi√°
            let childData = JSON.parse(localStorage.getItem(`${childName}Data`) || '{}');
            if (!childData.tasks) childData.tasks = {};
            if (!childData.tasks[today]) childData.tasks[today] = {};
            
            // C·∫≠p nh·∫≠t ƒë√°nh gi√° v√† th·ªëng k√™
            const previousRating = childData.tasks[today][taskId];
            childData.tasks[today][taskId] = rating;
            
            // X·ª≠ l√Ω th·ªëng k√™ tu·∫ßn
            updateWeeklyStats(childName, rating, previousRating);
            
            // T√≠nh ƒëi·ªÉm
            if (rating === 'good') {
                // Th√™m l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc khi ho√†n th√†nh t·ªët
                addWaterCredits(1);
                
                // Ph√°t √¢m thanh khen ng·ª£i
                const task = tasks[childName].find(t => t.id === taskId);
                if (task && task.audio) {
                    playAudio(task.audio);
                }
                
                // Hi·ªÉn th·ªã popup ch√∫c m·ª´ng
                showCongratulation(task.name, childName);
            } else if (rating === 'neutral') {
                // Ph√°t √¢m thanh "c·ªë g·∫Øng"
                playAudio("ban_co_gang_vao_lan_sau_nhe.mp3");
            } else if (rating === 'bad') {
                // Ph√°t √¢m thanh "ch∆∞a t·ªët"
                playAudio("chua_tot.mp3");
            }
            
            // L∆∞u d·ªØ li·ªáu
            localStorage.setItem(`${childName}Data`, JSON.stringify(childData));
            
            // C·∫≠p nh·∫≠t giao di·ªán
            updateTaskDisplay();
            updateStatsDisplay();
            
            // Ki·ªÉm tra v√† c·∫≠p nh·∫≠t huy hi·ªáu
            checkBadges(childName);
        }
        
        // C·∫≠p nh·∫≠t th·ªëng k√™ tu·∫ßn
        function updateWeeklyStats(childName, newRating, previousRating) {
            // T·∫£i th·ªëng k√™ hi·ªán t·∫°i
            loadWeeklyStats();
            
            // N·∫øu ƒë√£ c√≥ ƒë√°nh gi√° tr∆∞·ªõc ƒë√≥, tr·ª´ ƒëi
            if (previousRating) {
                weeklyStats[childName][previousRating]--;
            }
            
            // C·∫≠p nh·∫≠t ƒë√°nh gi√° m·ªõi
            weeklyStats[childName][newRating]++;
            
            // L∆∞u l·∫°i th·ªëng k√™
            saveWeeklyStats();
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
            updateStatsDisplay();
        }
        
        // L∆∞u th·ªëng k√™ tu·∫ßn
        function saveWeeklyStats() {
            localStorage.setItem('weeklyStats', JSON.stringify(weeklyStats));
        }
        
        // T·∫£i th·ªëng k√™ tu·∫ßn
        function loadWeeklyStats() {
            const savedStats = localStorage.getItem('weeklyStats');
            if (savedStats) {
                weeklyStats = JSON.parse(savedStats);
                // ƒê·∫£m b·∫£o c·∫£ hai b√© ƒë·ªÅu c√≥ d·ªØ li·ªáu
                if (!weeklyStats.tridung) {
                    weeklyStats.tridung = { good: 0, neutral: 0, bad: 0 };
                }
                if (!weeklyStats.thaoVy) {
                    weeklyStats.thaoVy = { good: 0, neutral: 0, bad: 0 };
                }
            } else {
                weeklyStats = {
                    tridung: { good: 0, neutral: 0, bad: 0 },
                    thaoVy: { good: 0, neutral: 0, bad: 0 }
                };
            }
        }
        
        // ƒê·∫∑t l·∫°i th·ªëng k√™ tu·∫ßn (khi b·∫Øt ƒë·∫ßu tu·∫ßn m·ªõi)
        function resetWeeklyStats() {
            // Ki·ªÉm tra x√°c nh·∫≠n
            const pin = prompt("Nh·∫≠p m√£ PIN ƒë·ªÉ x√°c nh·∫≠n ƒë·∫∑t l·∫°i th·ªëng k√™ (****)");
            if (pin !== "2022") {
                alert("M√£ PIN kh√¥ng ƒë√∫ng!");
                return;
            }
            
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t l·∫°i th·ªëng k√™ tu·∫ßn kh√¥ng?")) {
                weeklyStats = {
                    tridung: { good: 0, neutral: 0, bad: 0 },
                    thaoVy: { good: 0, neutral: 0, bad: 0 }
                };
                saveWeeklyStats();
                updateStatsDisplay();
                alert("ƒê√£ ƒë·∫∑t l·∫°i th·ªëng k√™ tu·∫ßn th√†nh c√¥ng!");
            }
        }
        
        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã th·ªëng k√™
        function updateStatsDisplay() {
            const stats = weeklyStats[currentStatsChild];
            
            // T·ªïng s·ªë nhi·ªám v·ª•
            const total = stats.good + stats.neutral + stats.bad;
            
            // Hi·ªÉn th·ªã c√°c gi√° tr·ªã
            document.getElementById('stats-good').textContent = stats.good;
            document.getElementById('stats-neutral').textContent = stats.neutral;
            document.getElementById('stats-bad').textContent = stats.bad;
            
            // T√≠nh v√† hi·ªÉn th·ªã ƒë·ªô tu√¢n th·ªß (t·ª∑ l·ªá t·ªët + ch·∫•p nh·∫≠n ƒë∆∞·ª£c)
            let complianceRate = 0;
            if (total > 0) {
                complianceRate = Math.round(((stats.good + stats.neutral) / total) * 100);
            }
            document.getElementById('stats-compliance').textContent = `${complianceRate}%`;
        }
        
        // Chuy·ªÉn ƒë·ªïi b√© trong th·ªëng k√™
        function switchStatsChild(childName) {
            currentStatsChild = childName;
            
            // C·∫≠p nh·∫≠t giao di·ªán n√∫t
            document.querySelectorAll('.stats-child-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.stats-child-btn[onclick="switchStatsChild('${childName}')"]`).classList.add('active');
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã th·ªëng k√™
            updateStatsDisplay();
        }
        
        // M·ªü dialog ƒëi·ªÅu ch·ªânh th·ªùi gian
        function openTimeSettings(childName) {
            // C·∫≠p nh·∫≠t n·ªôi dung dialog
            const settingsBody = document.getElementById('time-settings-body');
            settingsBody.innerHTML = '';
            
            const childTasks = tasks[childName];
            
            // T·∫°o c√°c input ƒëi·ªÅu ch·ªânh th·ªùi gian
            childTasks.forEach(task => {
                const timeItem = document.createElement('div');
                timeItem.className = 'time-item';
                timeItem.innerHTML = `
                    <div class="time-item-header">
                        <div class="time-name">${task.name}</div>
                    </div>
                    <input type="time" class="time-input" data-task-id="${task.id}" value="${task.time}" />
                `;
                settingsBody.appendChild(timeItem);
            });
            
            // L∆∞u tr·ªØ b√© ƒëang ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh
            settingsBody.setAttribute('data-child', childName);
            
            // Hi·ªÉn th·ªã dialog
            document.getElementById('time-settings').style.display = 'flex';
        }
        
        // ƒê√≥ng dialog ƒëi·ªÅu ch·ªânh th·ªùi gian
        function closeTimeSettings() {
            document.getElementById('time-settings').style.display = 'none';
        }
        
        // L∆∞u thay ƒë·ªïi th·ªùi gian
        function saveTimeSettings() {
            const settingsBody = document.getElementById('time-settings-body');
            const childName = settingsBody.getAttribute('data-child');
            
            // Thu th·∫≠p gi√° tr·ªã th·ªùi gian m·ªõi
            const timeInputs = settingsBody.querySelectorAll('.time-input');
            timeInputs.forEach(input => {
                const taskId = input.getAttribute('data-task-id');
                const newTime = input.value;
                
                // T√¨m v√† c·∫≠p nh·∫≠t nhi·ªám v·ª•
                const taskIndex = tasks[childName].findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    tasks[childName][taskIndex].time = newTime;
                }
            });
            
            // L∆∞u th·ªùi gian m·ªõi v√†o localStorage
            localStorage.setItem('customTasks', JSON.stringify(tasks));
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
            updateTaskDisplay();
            
            // ƒê√≥ng dialog
            closeTimeSettings();
            
            // Th√¥ng b√°o
            alert('ƒê√£ l∆∞u th·ªùi gian m·ªõi th√†nh c√¥ng!');
        }

        // H√†m hi·ªÉn th·ªã nhi·ªám v·ª• v·ªõi n√∫t ƒë√°nh gi√° trong m·ªôt h√†ng
        function updateTaskDisplay() {
            const taskLists = document.querySelectorAll('.task-list');
            taskLists.forEach(list => {
                list.innerHTML = '';
            });
            
            // L·∫•y ng√†y hi·ªán t·∫°i
            const today = new Date().toISOString().split('T')[0];
            
            // Hi·ªÉn th·ªã nhi·ªám v·ª• cho t·ª´ng b√©
            for (const childName in tasks) {
                const childData = JSON.parse(localStorage.getItem(`${childName}Data`) || '{}');
                const taskList = document.querySelector(`#${childName} .task-list`);
                
                if (!taskList) continue;
                
                tasks[childName].forEach(task => {
                    const rating = childData.tasks && childData.tasks[today] ? 
                                   childData.tasks[today][task.id] : null;
                    
                    const taskElement = document.createElement('div');
                    taskElement.className = `task ${rating ? 'completed-' + rating : ''}`;
                    taskElement.innerHTML = `
                        <div class="task-header">
                            <div class="task-time">${task.time}</div>
                            <div class="task-name">${task.name}</div>
                        </div>
                        <div class="rating-buttons">
                            <button class="rating-btn good-btn ${rating === 'good' ? 'active' : ''}" 
                                    onclick="rateTask('${childName}', '${task.id}', 'good')">
                                <i class="fas fa-smile"></i> T·ªët
                            </button>
                            <button class="rating-btn neutral-btn ${rating === 'neutral' ? 'active' : ''}" 
                                    onclick="rateTask('${childName}', '${task.id}', 'neutral')">
                                <i class="fas fa-meh"></i> Ch·∫•p nh·∫≠n ƒë∆∞·ª£c
                            </button>
                            <button class="rating-btn bad-btn ${rating === 'bad' ? 'active' : ''}" 
                                    onclick="rateTask('${childName}', '${task.id}', 'bad')">
                                <i class="fas fa-frown"></i> Ch∆∞a t·ªët
                            </button>
                        </div>
                    `;
                    
                    taskList.appendChild(taskElement);
                });
            }
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', function() {
            // T·∫£i th·ªùi gian t√πy ch·ªânh t·ª´ localStorage
            const savedTasks = localStorage.getItem('customTasks');
            if (savedTasks) {
                const parsedTasks = JSON.parse(savedTasks);
                // Ch·ªâ c·∫≠p nh·∫≠t n·∫øu c√≥ d·ªØ li·ªáu h·ª£p l·ªá
                if (parsedTasks.tridung && parsedTasks.tridung.length > 0 &&
                    parsedTasks.thaoVy && parsedTasks.thaoVy.length > 0) {
                    tasks.tridung = parsedTasks.tridung;
                    tasks.thaoVy = parsedTasks.thaoVy;
                }
            }
            
            // T·∫£i d·ªØ li·ªáu th·ªëng k√™
            loadWeeklyStats();
            
            // T·∫£i d·ªØ li·ªáu c√¢y
            loadData();
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã nhi·ªám v·ª•
            updateTaskDisplay();
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã th·ªëng k√™
            updateStatsDisplay();
            
            // C·∫≠p nh·∫≠t th·ªùi gian hi·ªán t·∫°i
            updateCurrentTime();
            
            // C·∫≠p nh·∫≠t th·ªùi gian m·ªói ph√∫t
            setInterval(updateCurrentTime, 60000);
            
            // Th√™m s·ª± ki·ªán cho c√°c tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const childName = this.getAttribute('data-child');
                    switchTab(childName);
                });
            });
            
            // S·ª± ki·ªán hi·ªÉn th·ªã/·∫©n Admin Panel
            const adminToggle = document.getElementById('admin-toggle');
            const adminPanel = document.getElementById('admin-panel');
            const closeAdmin = document.getElementById('close-admin');
            
            if (adminToggle) {
                adminToggle.addEventListener('click', function() {
                    const pin = prompt("Nh·∫≠p m√£ PIN ƒë·ªÉ truy c·∫≠p t√≠nh nƒÉng qu·∫£n tr·ªã (****)");
                    if (pin === "2022") {
                        adminPanel.style.display = adminPanel.style.display === 'none' ? 'block' : 'none';
                    } else {
                        alert("M√£ PIN kh√¥ng ƒë√∫ng!");
                    }
                });
            }
            
            if (closeAdmin) {
                closeAdmin.addEventListener('click', function() {
                    adminPanel.style.display = 'none';
                });
            }
            
            // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc
            if (document.getElementById("water-units")) {
                document.getElementById("water-units").textContent = waterCredits || 0;
            }
        });

        // C√°c h√†m kh√°c v·∫´n gi·ªØ nguy√™n...

        // Hi·ªÉn th·ªã ch√∫c m·ª´ng
        function showCongratulation(taskName, childName) {
            const popup = document.getElementById("popup-congrats");
            const popupText = document.getElementById("popup-text");
            
            // Hi·ªÉn th·ªã th√¥ng b√°o ph√π h·ª£p v·ªõi t·ª´ng b√©
            const childDisplayName = childName === 'thaoVy' ? 'Th·∫£o Vy' : 'Tr√≠ D≈©ng';
            popupText.innerText = `Ch√∫c m·ª´ng b√© ${childDisplayName} ho√†n th√†nh t·ªët nhi·ªám v·ª•: ${taskName}`;
            popup.style.display = "block";
            
            // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
            setTimeout(() => {
                popup.style.display = "none";
            }, 3000);
        }

        // H√†m chuy·ªÉn ƒë·ªïi tab
        function switchTab(childName) {
            currentChild = childName;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`.tab[data-child="${childName}"]`).classList.add('active');
            
            // Hi·ªÉn th·ªã n·ªôi dung t∆∞∆°ng ·ª©ng
            document.querySelectorAll('.child-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(childName).style.display = 'block';
            
            // ·∫®n/hi·ªán profile t∆∞∆°ng ·ª©ng
            document.getElementById('tridung-profile').style.display = childName === 'tridung' ? 'flex' : 'none';
            document.getElementById('thaoVy-profile').style.display = childName === 'thaoVy' ? 'flex' : 'none';
            
            // C·∫≠p nh·∫≠t t√™n c√¢y
            const treeName = document.getElementById('tree-name');
            if (treeName) {
                treeName.textContent = `C√¢y c·ªßa b√© ${childName === 'tridung' ? 'Tr√≠ D≈©ng' : 'Th·∫£o Vy'}`;
            }
        }

        // H√†m c·∫≠p nh·∫≠t th·ªùi gian hi·ªán t·∫°i
        function updateCurrentTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'numeric', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const timeString = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('vi-VN', options);
            
            const timeElements = document.querySelectorAll('.current-time');
            timeElements.forEach(el => {
                el.textContent = `${timeString}, ${dateString.charAt(0).toUpperCase() + dateString.slice(1)}`;
            });
            
            // Ki·ªÉm tra th√¥ng b√°o nhi·ªám v·ª•
            checkTaskNotifications();
        }

        // C√°c h√†m c√≤n l·∫°i gi·ªØ nguy√™n...

        // H√†m t·∫£i d·ªØ li·ªáu
        function loadData() {
            // T·∫£i d·ªØ li·ªáu c√¢y
            treeLevel = parseInt(localStorage.getItem('treeLevel') || '1');
            waterCredits = parseInt(localStorage.getItem('waterCredits') || '0');
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã c√¢y
            updateTreeDisplay();
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc
            if (document.getElementById('water-units')) {
                document.getElementById('water-units').textContent = waterCredits;
            }
        }
        
        // H√†m l∆∞u d·ªØ li·ªáu
        function saveData() {
            localStorage.setItem('treeLevel', treeLevel);
            localStorage.setItem('waterCredits', waterCredits);
        }
        
        // H√†m t∆∞·ªõi n∆∞·ªõc cho c√¢y
        function waterTree() {
            if (waterCredits <= 0) {
                alert("B·∫°n kh√¥ng c√≥ ƒë·ªß l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc. H√£y ho√†n th√†nh t·ªët nhi·ªám v·ª• ƒë·ªÉ nh·∫≠n th√™m!");
                return;
            }
            
            // Gi·∫£m l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc
            waterCredits--;
            
            // Hi·ªÉn th·ªã animation t∆∞·ªõi n∆∞·ªõc
            const wateringGif = document.getElementById('watering-gif');
            if (wateringGif) {
                wateringGif.style.display = 'block';
                wateringGif.style.left = '50%';
                wateringGif.style.transform = 'translateX(-50%)';
                
                setTimeout(() => {
                    wateringGif.style.display = 'none';
                }, 2000);
            }
            
            // TƒÉng c·∫•p ƒë·ªô c√¢y n·∫øu ch∆∞a ƒë·∫°t t·ªëi ƒëa
            if (treeLevel < 7) {
                treeLevel++;
                
                // Hi·ªÉn th·ªã hi·ªáu ·ª©ng ph√°t tri·ªÉn
                const treeImg = document.getElementById('tree-img');
                if (treeImg) {
                    treeImg.classList.add('tree-growth');
                    setTimeout(() => {
                        treeImg.classList.remove('tree-growth');
                    }, 1000);
                }
                
                // Hi·ªáu ·ª©ng ph·∫ßn th∆∞·ªüng khi c√¢y ƒë·∫°t c·∫•p ƒë·ªô cu·ªëi c√πng
                if (treeLevel === 7) {
                    setTimeout(() => {
                        triggerFireworks();
                        playAudio('firework.mp3');
                        alert("Ch√∫c m·ª´ng! C√¢y c·ªßa b·∫°n ƒë√£ ph√°t tri·ªÉn ho√†n to√†n!");
                    }, 2000);
                }
            }
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã c√¢y
            updateTreeDisplay();
            
            // L∆∞u d·ªØ li·ªáu
            saveData();
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc
            if (document.getElementById('water-units')) {
                document.getElementById('water-units').textContent = waterCredits;
            }
        }
        
        // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã c√¢y
        function updateTreeDisplay() {
            const treeImg = document.getElementById('tree-img');
            if (!treeImg) return;
            
            // C·∫≠p nh·∫≠t h√¨nh ·∫£nh c√¢y theo c·∫•p ƒë·ªô
            treeImg.src = `images/tree_day${treeLevel}.png`;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i c√¢y
            const treeStatus = document.getElementById('tree-status');
            if (treeStatus) {
                if (treeLevel < 7) {
                    treeStatus.textContent = "C√¢y c·∫ßn n∆∞·ªõc ƒë·ªÉ ph√°t tri·ªÉn!";
                    treeStatus.style.color = "#FFEB3B";
                } else {
                    treeStatus.textContent = "C√¢y ƒë√£ ph√°t tri·ªÉn ho√†n to√†n!";
                    treeStatus.style.color = "#4CAF50";
                }
            }
        }
        
        // H√†m th√™m l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc
        function addWaterCredits(amount) {
            waterCredits += amount;
            localStorage.setItem('waterCredits', waterCredits);
            
            if (document.getElementById('water-units')) {
                document.getElementById('water-units').textContent = waterCredits;
            }
        }
        
        // H√†m ƒë·∫∑t l·∫°i c√¢y
        function resetTree() {
            const pin = prompt("Nh·∫≠p m√£ PIN ƒë·ªÉ x√°c nh·∫≠n ƒë·∫∑t l·∫°i c√¢y (****)");
            if (pin !== "2022") {
                alert("M√£ PIN kh√¥ng ƒë√∫ng!");
                return;
            }
            
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t l·∫°i c√¢y kh√¥ng? C√¢y s·∫Ω tr·ªü v·ªÅ c·∫•p ƒë·ªô 1.")) {
                treeLevel = 1;
                saveData();
                updateTreeDisplay();
                alert("ƒê√£ ƒë·∫∑t l·∫°i c√¢y th√†nh c√¥ng!");
            }
        }
        
        // H√†m ki·ªÉm tra v√† hi·ªÉn th·ªã th√¥ng b√°o nhi·ªám v·ª•
        function checkTaskNotifications() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTimeStr = `${currentHour.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;
            
            // Ki·ªÉm tra c√°c nhi·ªám v·ª• cho c·∫£ hai b√©
            for (const childName in tasks) {
                const childTasks = tasks[childName];
                
                childTasks.forEach(task => {
                    // N·∫øu b√¢y gi·ªù l√† th·ªùi gian c·ªßa nhi·ªám v·ª• (trong ph·∫°m vi 5 ph√∫t)
                    const taskHour = parseInt(task.time.split(':')[0]);
                    const taskMinute = parseInt(task.time.split(':')[1]);
                    
                    if (currentHour === taskHour && Math.abs(currentMinute - taskMinute) <= 5) {
                        // Ki·ªÉm tra xem nhi·ªám v·ª• ƒë√£ ƒë∆∞·ª£c th√¥ng b√°o ch∆∞a
                        const notifiedTasks = JSON.parse(localStorage.getItem('notifiedTasks') || '{}');
                        const today = now.toISOString().split('T')[0];
                        
                        if (!notifiedTasks[today] || !notifiedTasks[today][`${childName}-${task.id}`]) {
                            // Hi·ªÉn th·ªã th√¥ng b√°o
                            const childDisplayName = childName === 'thaoVy' ? 'Th·∫£o Vy' : 'Tr√≠ D≈©ng';
                            const notification = new Notification(`Nhi·ªám v·ª• cho b√© ${childDisplayName}`, {
                                body: `ƒê√£ ƒë·∫øn gi·ªù: ${task.name} (${task.time})`,
                                icon: `images/${childName === 'thaoVy' ? 'vy.jpg' : 'vit.jpg'}`
                            });
                            
                            // ƒê√°nh d·∫•u ƒë√£ th√¥ng b√°o
                            if (!notifiedTasks[today]) notifiedTasks[today] = {};
                            notifiedTasks[today][`${childName}-${task.id}`] = true;
                            localStorage.setItem('notifiedTasks', JSON.stringify(notifiedTasks));
                            
                            // Ph√°t √¢m thanh
                            if (task.audio) {
                                playAudio(task.audio);
                            }
                        }
                    }
                });
            }
        }
        
        // Y√™u c·∫ßu quy·ªÅn hi·ªÉn th·ªã th√¥ng b√°o
        function requestNotificationPermission() {
            if ('Notification' in window) {
                if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                    Notification.requestPermission().then(function(permission) {
                        if (permission === 'granted') {
                            new Notification("Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c b·∫≠t", {
                                body: "B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o khi ƒë·∫øn gi·ªù th·ª±c hi·ªán nhi·ªám v·ª•.",
                                icon: "images/vit.jpg"
                            });
                        }
                    });
                }
            }
        }
        
        // Ki·ªÉm tra huy hi·ªáu
        function checkBadges(childName) {
            const today = new Date().toISOString().split('T')[0];
            
            const childData = JSON.parse(localStorage.getItem(`${childName}Data`) || '{}');
            if (!childData.tasks || !childData.tasks[today]) return;
            
            const todayTasks = childData.tasks[today];
            
            // ƒê·∫øm s·ªë nhi·ªám v·ª• ƒë∆∞·ª£c ho√†n th√†nh t·ªët
            const goodTasks = Object.values(todayTasks).filter(rating => rating === 'good').length;
            const totalTasks = tasks[childName].length;
            
            // N·∫øu t·∫•t c·∫£ nhi·ªám v·ª• ƒë·ªÅu ho√†n th√†nh t·ªët
            if (goodTasks === totalTasks) {
                // Th√™m th∆∞·ªüng ƒë·∫∑c bi·ªát
                addWaterCredits(2);
                
                // Hi·ªÉn th·ªã th√¥ng b√°o
                const childDisplayName = childName === 'thaoVy' ? 'Th·∫£o Vy' : 'Tr√≠ D≈©ng';
                
                // Hi·ªáu ·ª©ng ph√°o hoa
                setTimeout(() => {
                    triggerFireworks();
                    alert(`Tuy·ªát v·ªùi! B√© ${childDisplayName} ƒë√£ ho√†n th√†nh t·∫•t c·∫£ nhi·ªám v·ª• h√¥m nay v·ªõi m·ª©c "T·ªët".\nB·∫°n nh·∫≠n ƒë∆∞·ª£c 2 l∆∞·ª£t t∆∞·ªõi n∆∞·ªõc ƒë·∫∑c bi·ªát!`);
                }, 1000);
            }
        }
        
        // T·∫°o hi·ªáu ·ª©ng ph√°o hoa
        function triggerFireworks() {
            // T·∫°o container ph√°o hoa
            let fireworksContainer = document.createElement('div');
            fireworksContainer.id = 'fireworks-container';
            fireworksContainer.style.position = 'fixed';
            fireworksContainer.style.top = '0';
            fireworksContainer.style.left = '0';
            fireworksContainer.style.width = '100%';
            fireworksContainer.style.height = '100%';
            fireworksContainer.style.pointerEvents = 'none';
            fireworksContainer.style.zIndex = '9999';
            document.body.appendChild(fireworksContainer);
            
            // T·∫°o c√°c m√†u ph√°o hoa ng·∫´u nhi√™n
            const colors = ['#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41', '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'];
            
            // T·∫°o 20 ph√°o hoa
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createFirework(fireworksContainer, colors);
                }, i * 300);
            }
            
            // X√≥a container sau khi ho√†n th√†nh
            setTimeout(() => {
                fireworksContainer.remove();
            }, 7000);
        }
        
        // T·∫°o m·ªôt ph√°o hoa
        function createFirework(container, colors) {
            const x = Math.random() * 100;
            const y = Math.random() * 60 + 20;
            const size = Math.random() * 5 + 3;
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // T·∫°o ph√°o hoa
            const firework = document.createElement('div');
            firework.style.position = 'absolute';
            firework.style.left = `${x}%`;
            firework.style.top = `${y}%`;
            firework.style.width = `${size}px`;
            firework.style.height = `${size}px`;
            firework.style.borderRadius = '50%';
            firework.style.backgroundColor = color;
            firework.style.boxShadow = `0 0 ${size * 2}px ${size}px ${color}`;
            
            // Th√™m animation
            firework.style.animation = 'explode 1s forwards';
            
            // Th√™m keyframes n·∫øu ch∆∞a c√≥
            if (!document.getElementById('fireworks-animation')) {
                const style = document.createElement('style');
                style.id = 'fireworks-animation';
                style.innerHTML = `
                    @keyframes explode {
                        0% { transform: scale(0); opacity: 0; }
                        50% { transform: scale(1); opacity: 1; }
                        100% { transform: scale(1.5); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            container.appendChild(firework);
            
            // T·∫°o tia ph√°o hoa
            for (let i = 0; i < 8; i++) {
                const ray = document.createElement('div');
                const angle = (i / 8) * 360;
                const raySize = size * 0.8;
                
                ray.style.position = 'absolute';
                ray.style.width = `${raySize}px`;
                ray.style.height = `${raySize}px`;
                ray.style.borderRadius = '50%';
                ray.style.backgroundColor = color;
                ray.style.boxShadow = `0 0 ${raySize}px ${raySize / 2}px ${color}`;
                ray.style.left = `${x}%`;
                ray.style.top = `${y}%`;
                ray.style.animation = `fireworkRay${i} 0.8s forwards`;
                
                container.appendChild(ray);
                
                // Th√™m keyframes cho tia
                if (!document.getElementById(`firework-ray-${i}`)) {
                    const rayStyle = document.createElement('style');
                    rayStyle.id = `firework-ray-${i}`;
                    const distance = 100 + Math.random() * 50;
                    rayStyle.innerHTML = `
                        @keyframes fireworkRay${i} {
                            0% { transform: translate(-50%, -50%) rotate(${angle}deg) translateX(0); opacity: 1; }
                            100% { transform: translate(-50%, -50%) rotate(${angle}deg) translateX(${distance}px); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(rayStyle);
                }
            }
            
            // X√≥a ph√°o hoa sau khi hi·ªáu ·ª©ng k·∫øt th√∫c
            setTimeout(() => {
                firework.remove();
            }, 1000);
        }
        
        // Chuy·ªÉn ƒë·ªïi hi·ªÉn th·ªã th·ªëng k√™
        function toggleStatsView() {
            // Animation xoay bi·ªÉu t∆∞·ª£ng
            const toggleBtn = document.querySelector('.stats-view-toggle i');
            toggleBtn.style.transition = 'transform 0.5s';
            toggleBtn.style.transform = 'rotate(180deg)';
            
            setTimeout(() => {
                toggleBtn.style.transform = 'rotate(360deg)';
            }, 500);
        }

        // Y√™u c·∫ßu quy·ªÅn th√¥ng b√°o khi trang web ƒë∆∞·ª£c t·∫£i
        document.addEventListener('DOMContentLoaded', function() {
            requestNotificationPermission();
        });
    </script>
</body>
</html>