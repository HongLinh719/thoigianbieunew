<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Th·ªùi gian bi·ªÉu cho b√©</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<style>
        :root {
            --primary-color: #FF7043;
            --secondary-color: #FFAB91;
            --neutral-color: #FBE9E7;
            --text-color: #3E2723;
            --light-text: #795548;
            --success-color: #66BB6A;
            --warning-color: #FFCA28;
            --danger-color: #EF5350;
        }
        
        body {
            font-family: 'Baloo 2', cursive;
            margin: 0;
            padding: 0;
            background-color: var(--neutral-color);
            color: var(--text-color);
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
        }
        
        .date-container {
            background-color: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .date-display {
            font-size: 18px;
            font-weight: 600;
        }
        
        .date-nav {
            display: flex;
            gap: 15px;
        }
        
        .date-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .progress {
            height: 30px;
            background-color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            text-align: center;
            line-height: 30px;
            color: white;
            font-weight: 600;
            transition: width 0.5s;
        }
        
        .task-list {
            margin-bottom: 20px;
        }
        
        .task {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .task.completed-good {
            border-left: 5px solid var(--success-color);
        }
        
        .task.completed-neutral {
            border-left: 5px solid var(--warning-color);
        }
        
        .task.completed-bad {
            border-left: 5px solid var(--danger-color);
        }
        
        .task-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-time {
            background-color: var(--neutral-color);
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: 600;
            margin-right: 10px;
            font-size: 14px;
        }
        
        .task-name {
            font-weight: 600;
            font-size: 16px;
            flex-grow: 1;
        }
        
        .rating-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .rating-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .good-btn {
            background-color: #E8F5E9;
            color: var(--success-color);
        }
        
        .good-btn:hover, .good-btn.active {
            background-color: var(--success-color);
            color: white;
        }
        
        .neutral-btn {
            background-color: #FFF8E1;
            color: var(--warning-color);
        }
        
        .neutral-btn:hover, .neutral-btn.active {
            background-color: var(--warning-color);
            color: white;
        }
        
        .bad-btn {
            background-color: #FFEBEE;
            color: var(--danger-color);
        }
        
        .bad-btn:hover, .bad-btn.active {
            background-color: var(--danger-color);
            color: white;
        }
        
        .reward {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #FFD54F, #FFCA28);
            border-radius: 12px;
            margin-top: 20px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }
        
        .reward.active {
            display: block;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            animation: slideDown 0.5s;
        }
        
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        .stats-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .stats-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .stats-modal.active {
            visibility: visible;
            opacity: 1;
        }
        
        .stats-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .stats-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .stats-chart {
            height: 200px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }
        
        .chart-bar {
            flex: 1;
            background-color: var(--primary-color);
            transition: height 0.5s;
            border-radius: 5px 5px 0 0;
            position: relative;
            min-width: 30px;
        }
        
        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
        }
        
        .chart-bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: 600;
        }
        
        .stats-summary {
            margin-top: 40px;
            background-color: var(--neutral-color);
            padding: 15px;
            border-radius: 10px;
        }
        
        .sleep-record {
            display: flex;
            justify-content: space-between;
            background-color: #E8F5E9;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .sleep-record.good {
            background-color: #E8F5E9;
            border-left: 4px solid var(--success-color);
        }
        
        .sleep-record.neutral {
            background-color: #FFF8E1;
            border-left: 4px solid var(--warning-color);
        }
        
        .sleep-record.bad {
            background-color: #FFEBEE;
            border-left: 4px solid var(--danger-color);
        }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<h1>Th·ªùi gian bi·ªÉu cho b√©</h1>
</div>
<div class="date-container">
<div class="date-display" id="currentDate">H√¥m nay, 17/04/2025</div>
<div class="date-nav">
<button class="date-btn" onclick="changeDate(-1)"><i class="fas fa-chevron-left"></i></button>
<button class="date-btn" onclick="changeDate(1)"><i class="fas fa-chevron-right"></i></button>
</div>
</div>
<div class="tabs">
<div class="tab active" onclick="switchTab('tridung')">Tr√≠ D≈©ng (5 tu·ªïi)</div>
<div class="tab" onclick="switchTab('thaoVy')">Th·∫£o Vy (3 tu·ªïi)</div>
</div>
<div class="progress">
<div class="progress-bar" id="progressBar" style="width: 0%">0/16 ƒëi·ªÉm</div>
</div>
<div class="child-tab" id="tridung">
<div class="sleep-record" id="sleepRecord">
<div><i class="fas fa-bed"></i> Ng·ªß ƒë√™m qua:</div>
<div id="sleepStatus">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
</div>
<div class="task-list">
<!-- Tasks will be added here dynamically -->
</div>
</div>
<div class="child-tab" id="thaoVy" style="display:none">
<div class="sleep-record" id="sleepRecordThaoVy">
<div><i class="fas fa-bed"></i> Ng·ªß ƒë√™m qua:</div>
<div id="sleepStatusThaoVy">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
</div>
<div class="task-list">
<!-- Tasks will be added here dynamically -->
</div>
</div>
<div class="reward" id="reward">
<i class="fas fa-trophy"></i> Ch√∫c m·ª´ng! B√© ƒë√£ ho√†n th√†nh nhi·ªám v·ª• v√† ƒë∆∞·ª£c ph√©p ch∆°i thi·∫øt b·ªã ƒëi·ªán t·ª≠ t·ª´ 20:00 - 21:00
        </div>
</div>
<div class="notification" id="notification">
<i class="fas fa-bell"></i> ƒê·∫øn gi·ªù th·ª±c hi·ªán nhi·ªám v·ª• m·ªõi!
    </div>
<button class="stats-btn" onclick="toggleStats()">
<i class="fas fa-chart-bar"></i>
</button>
<div class="stats-modal" id="statsModal">
<div class="stats-content">
<div class="stats-header">
<h2>Th·ªëng k√™ ho·∫°t ƒë·ªông</h2>
<button class="stats-close" onclick="toggleStats()"><i class="fas fa-times"></i></button>
</div>
<div class="stats-chart" id="statsChart">
<!-- Chart bars will be added here -->
</div>
<div class="stats-summary">
<h3>T√≥m t·∫Øt 7 ng√†y qua</h3>
<p><strong>T·ªïng ƒëi·ªÉm:</strong> <span id="totalPoints">0</span> ƒëi·ªÉm</p>
<p><strong>ƒêi·ªÉm trung b√¨nh:</strong> <span id="averagePoints">0</span> ƒëi·ªÉm/ng√†y</p>
<p><strong>Ng√†y t·ªët nh·∫•t:</strong> <span id="bestDay">Ch∆∞a c√≥ d·ªØ li·ªáu</span></p>
<p><strong>S·ªë ng√†y ƒë∆∞·ª£c ch∆°i thi·∫øt b·ªã:</strong> <span id="deviceDays">0</span>/7 ng√†y</p>
</div>
</div>
</div>
<script>
        // Thi·∫øt l·∫≠p ng√†y hi·ªán t·∫°i
        let currentDate = new Date();
        let currentChild = 'tridung';
        
        // D·ªØ li·ªáu l∆∞u tr·ªØ
        const storageKey = 'kidScheduleData';
        let scheduleData = {
            tridung: {},
            thaoVy: {}
        };
        
        // H·∫°ng m·ª•c ƒë√°nh gi√°
        const ratingValues = {
            good: 3,
            neutral: 1,
            bad: 0
        };
        
        // Danh s√°ch nhi·ªám v·ª• c·ªë ƒë·ªãnh
        const taskTemplates = {
            tridung: [
                { id: 1, time: "21:00", name: "ƒêi ng·ªß (ƒë√™m qua)", isPreviousSleep: true, ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] },
                { id: 2, time: "6:30 - 7:00", name: "Th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n, ƒëi h·ªçc", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 3, time: "17:00 - 18:00", name: "Ch∆°i t·ª± do", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 4, time: "18:00 - 18:30", name: "ƒÇn t·ªëi t·∫°i nh√†", ratings: ["ƒÇn nhanh v√† nhi·ªÅu", "ƒÇn ch·∫≠m", "Kh√¥ng ch·ªãu ƒÉn"] },
                { id: 5, time: "18:30 - 19:00", name: "V·ªá sinh c√° nh√¢n bu·ªïi t·ªëi", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 6, time: "19:00 - 20:00", name: "ƒê·ªçc s√°ch, t√¥ m√†u ho·∫∑c l√†m to√°n", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 7, time: "21:00", name: "ƒêi ng·ªß", ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] }
            ],
            thaoVy: [
                { id: 1, time: "21:00", name: "ƒêi ng·ªß (ƒë√™m qua)", isPreviousSleep: true, ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] },
                { id: 2, time: "6:30 - 7:00", name: "Th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n, ƒëi h·ªçc", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 3, time: "17:00 - 18:00", name: "Ch∆°i t·ª± do", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 4, time: "18:00 - 18:30", name: "ƒÇn t·ªëi t·∫°i nh√†", ratings: ["ƒÇn nhanh v√† nhi·ªÅu", "ƒÇn ch·∫≠m", "Kh√¥ng ch·ªãu ƒÉn"] },
                { id: 5, time: "18:30 - 19:00", name: "V·ªá sinh c√° nh√¢n bu·ªïi t·ªëi", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 6, time: "19:00 - 20:00", name: "ƒê·ªçc s√°ch, t√¥ m√†u", ratings: ["T·ªët", "Ch∆∞a ƒë∆∞·ª£c t·ªët", "Ch∆∞a t·ªët"] },
                { id: 7, time: "21:00", name: "ƒêi ng·ªß", ratings: ["ƒê√∫ng gi·ªù", "Tr·ªÖ gi·ªù", "Kh√¥ng ng·ªß"] }
            ]
        };
        
        // Hi·ªÉn th·ªã ng√†y hi·ªán t·∫°i
        function updateDateDisplay() {
            const options = { weekday: 'long', day: 'numeric', month: 'numeric', year: 'numeric' };
            const dateString = currentDate.toLocaleDateString('vi-VN', options);
            const capitalizedDate = dateString.charAt(0).toUpperCase() + dateString.slice(1);
            document.getElementById('currentDate').textContent = capitalizedDate;
        }
        
        // ƒê·ªïi ng√†y
        function changeDate(delta) {
            const newDate = new Date(currentDate);
            newDate.setDate(newDate.getDate() + delta);
            currentDate = newDate;
            updateDateDisplay();
            renderTasks();
            updateSleepRecord();
            checkReward();
        }
        
        // L·∫•y key cho ng√†y hi·ªán t·∫°i
        function getDateKey(date = currentDate) {
            return date.toISOString().split('T')[0];
        }
        
        // L·∫•y key cho ng√†y h√¥m tr∆∞·ªõc
        function getPreviousDateKey() {
            const prevDate = new Date(currentDate);
            prevDate.setDate(prevDate.getDate() - 1);
            return getDateKey(prevDate);
        }
        
        // C·∫≠p nh·∫≠t tr·∫°ng th√°i ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc
        function updateSleepRecord() {
            const prevDateKey = getPreviousDateKey();
            const currentDateKey = getDateKey();
            
            // Ki·ªÉm tra tr·∫°ng th√°i ng·ªß cho Tr√≠ D≈©ng
            const sleepStatus = document.getElementById('sleepStatus');
            if (scheduleData.tridung[prevDateKey] && scheduleData.tridung[prevDateKey].tasks) {
                const sleepTask = scheduleData.tridung[prevDateKey].tasks.find(t => t.id === 7);
                if (sleepTask && sleepTask.rating) {
                    sleepStatus.textContent = sleepTask.rating === 'good' ? 'T·ªët' : 
                                              sleepTask.rating === 'neutral' ? 'Tr·ªÖ gi·ªù' : 'Kh√¥ng ng·ªß';
                    
                    const sleepRecord = document.getElementById('sleepRecord');
                    sleepRecord.className = 'sleep-record ' + sleepTask.rating;
                } else {
                    sleepStatus.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                    document.getElementById('sleepRecord').className = 'sleep-record';
                }
            } else {
                sleepStatus.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                document.getElementById('sleepRecord').className = 'sleep-record';
            }
            
            // Ki·ªÉm tra tr·∫°ng th√°i ng·ªß cho Th·∫£o Vy
            const sleepStatusThaoVy = document.getElementById('sleepStatusThaoVy');
            if (scheduleData.thaoVy[prevDateKey] && scheduleData.thaoVy[prevDateKey].tasks) {
                const sleepTaskThaoVy = scheduleData.thaoVy[prevDateKey].tasks.find(t => t.id === 7);
                if (sleepTaskThaoVy && sleepTaskThaoVy.rating) {
                    sleepStatusThaoVy.textContent = sleepTaskThaoVy.rating === 'good' ? 'T·ªët' : 
                                                  sleepTaskThaoVy.rating === 'neutral' ? 'Tr·ªÖ gi·ªù' : 'Kh√¥ng ng·ªß';
                    
                    const sleepRecordThaoVy = document.getElementById('sleepRecordThaoVy');
                    sleepRecordThaoVy.className = 'sleep-record ' + sleepTaskThaoVy.rating;
                } else {
                    sleepStatusThaoVy.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                    document.getElementById('sleepRecordThaoVy').className = 'sleep-record';
                }
            } else {
                sleepStatusThaoVy.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
                document.getElementById('sleepRecordThaoVy').className = 'sleep-record';
            }
            
            // Chu·∫©n b·ªã d·ªØ li·ªáu cho ng√†y hi·ªán t·∫°i n·∫øu ch∆∞a c√≥
            ['tridung', 'thaoVy'].forEach(child => {
                if (!scheduleData[child][currentDateKey]) {
                    scheduleData[child][currentDateKey] = {
                        tasks: [],
                        totalPoints: 0
                    };
                    
                    // T·∫°o c√°c nhi·ªám v·ª• t·ª´ template
                    scheduleData[child][currentDateKey].tasks = taskTemplates[child].map(template => {
                        return {
                            id: template.id,
                            time: template.time,
                            name: template.name,
                            isPreviousSleep: template.isPreviousSleep || false,
                            rating: null
                        };
                    });
                }
            });
        }
        
        // Hi·ªÉn th·ªã danh s√°ch nhi·ªám v·ª•
        function renderTasks() {
            const dateKey = getDateKey();
            
            // Render nhi·ªám v·ª• cho Tr√≠ D≈©ng
            const tridungTaskList = document.querySelector('#tridung .task-list');
            tridungTaskList.innerHTML = '';
            
            if (scheduleData.tridung[dateKey] && scheduleData.tridung[dateKey].tasks) {
                // L·ªçc ra nhi·ªám v·ª• c·ªßa ng√†y hi·ªán t·∫°i (kh√¥ng ph·∫£i ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc)
                const currentTasks = scheduleData.tridung[dateKey].tasks.filter(task => !task.isPreviousSleep);
                
                currentTasks.forEach(task => {
                    const taskElement = createTaskElement(task, 'tridung');
                    tridungTaskList.appendChild(taskElement);
                });
            }
            
            // Render nhi·ªám v·ª• cho Th·∫£o Vy
            const thaoVyTaskList = document.querySelector('#thaoVy .task-list');
            thaoVyTaskList.innerHTML = '';
            
            if (scheduleData.thaoVy[dateKey] && scheduleData.thaoVy[dateKey].tasks) {
                // L·ªçc ra nhi·ªám v·ª• c·ªßa ng√†y hi·ªán t·∫°i (kh√¥ng ph·∫£i ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc)
                const currentTasks = scheduleData.thaoVy[dateKey].tasks.filter(task => !task.isPreviousSleep);
                
                currentTasks.forEach(task => {
                    const taskElement = createTaskElement(task, 'thaoVy');
                    thaoVyTaskList.appendChild(taskElement);
                });
            }
            
            updateProgress();
        }
        
        // T·∫°o ph·∫ßn t·ª≠ nhi·ªám v·ª•
        function createTaskElement(task, childName) {
            const taskElement = document.createElement('div');
            taskElement.className = `task ${task.rating ? 'completed-' + task.rating : ''}`;
            
            const template = taskTemplates[childName].find(t => t.id === task.id);
            
            taskElement.innerHTML = `
                <div class="task-header">
                    <div class="task-time">${task.time}</div>
                    <div class="task-name">${task.name}</div>
                </div>
                <div class="rating-buttons">
                    <button class="rating-btn good-btn ${task.rating === 'good' ? 'active' : ''}" 
                            onclick="rateTask('${childName}', ${task.id}, 'good')">
                        <i class="fas fa-smile"></i> ${template.ratings[0]}
                    </button>
                    <button class="rating-btn neutral-btn ${task.rating === 'neutral' ? 'active' : ''}" 
                            onclick="rateTask('${childName}', ${task.id}, 'neutral')">
                        <i class="fas fa-meh"></i> ${template.ratings[1]}
                    </button>
                    <button class="rating-btn bad-btn ${task.rating === 'bad' ? 'active' : ''}" 
                            onclick="rateTask('${childName}', ${task.id}, 'bad')">
                        <i class="fas fa-frown"></i> ${template.ratings[2]}
                    </button>
                </div>
            `;
            
            return taskElement;
        }
        
        // ƒê√°nh gi√° nhi·ªám v·ª•
        function rateTask(childName, taskId, rating) {
            // X√°c th·ª±c m√£ PIN ƒë∆°n gi·∫£n
            const pin = prompt("Nh·∫≠p m√£ PIN ƒë·ªÉ x√°c nh·∫≠n (m·∫∑c ƒë·ªãnh: 1234):");
            if (pin !== "1234") {
                alert("M√£ PIN kh√¥ng ƒë√∫ng!");
                return;
            }
            
            const dateKey = getDateKey();
            
            if (scheduleData[childName][dateKey] && scheduleData[childName][dateKey].tasks) {
                const task = scheduleData[childName][dateKey].tasks.find(t => t.id === taskId);
                if (task) {
                    // C·∫≠p nh·∫≠t ƒë√°nh gi√°
                    task.rating = rating;
                    
                    // T√≠nh l·∫°i t·ªïng ƒëi·ªÉm
                    recalculateTotalPoints(childName, dateKey);
                    
                    // C·∫≠p nh·∫≠t giao di·ªán
                    renderTasks();
                    updateProgress();
                    checkReward();
                    saveData();
                }
            }
        }
        
        // T√≠nh l·∫°i t·ªïng ƒëi·ªÉm
        function recalculateTotalPoints(childName, dateKey) {
            let totalPoints = 0;
            
            if (scheduleData[childName][dateKey] && scheduleData[childName][dateKey].tasks) {
                scheduleData[childName][dateKey].tasks.forEach(task => {
                    if (task.rating) {
                        totalPoints += ratingValues[task.rating];
                    }
                });
scheduleData[childName][dateKey].totalPoints = totalPoints;
            }
        }
        
        // C·∫≠p nh·∫≠t thanh ti·∫øn tr√¨nh
        function updateProgress() {
            const dateKey = getDateKey();
            const childData = scheduleData[currentChild][dateKey];
            
            if (childData) {
                const totalPoints = childData.totalPoints || 0;
                const maxPoints = taskTemplates[currentChild].length * 3;
                const progressPercent = (totalPoints / maxPoints) * 100;
                
                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = `${progressPercent}%`;
                progressBar.textContent = `${totalPoints}/${maxPoints} ƒëi·ªÉm`;
            }
        }
        
        // Ki·ªÉm tra xem c√≥ ƒë·∫°t y√™u c·∫ßu nh·∫≠n ph·∫ßn th∆∞·ªüng kh√¥ng
        function checkReward() {
            const dateKey = getDateKey();
            const prevDateKey = getPreviousDateKey();
            
            // Ki·ªÉm tra xem c√≥ d·ªØ li·ªáu cho ng√†y hi·ªán t·∫°i v√† ng√†y h√¥m tr∆∞·ªõc kh√¥ng
            if (!scheduleData[currentChild][dateKey] || !scheduleData[currentChild][prevDateKey]) {
                document.getElementById('reward').classList.remove('active');
                return;
            }
            
            // Ki·ªÉm tra ƒë√°nh gi√° ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc
            const previousSleepTask = scheduleData[currentChild][prevDateKey].tasks.find(t => t.id === 7);
            const goodSleepYesterday = previousSleepTask && (previousSleepTask.rating === 'good' || previousSleepTask.rating === 'neutral');
            
            // Ki·ªÉm tra t·ªïng ƒëi·ªÉm c·ªßa ng√†y h√¥m nay (c·∫ßn ƒë·∫°t √≠t nh·∫•t 12 ƒëi·ªÉm)
            const goodPointsToday = scheduleData[currentChild][dateKey].totalPoints >= 12;
            
            // Hi·ªÉn th·ªã ph·∫ßn th∆∞·ªüng n·∫øu ƒë·ªß ƒëi·ªÅu ki·ªán
            const rewardElement = document.getElementById('reward');
            if (goodSleepYesterday && goodPointsToday) {
                rewardElement.classList.add('active');
            } else {
                rewardElement.classList.remove('active');
            }
        }
        
        // Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c tab
        function switchTab(childName) {
            currentChild = childName;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i tab
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`.tab[onclick="switchTab('${childName}')"]`);
            activeTab.classList.add('active');
            
            // Hi·ªÉn th·ªã tab con t∆∞∆°ng ·ª©ng
            const childTabs = document.querySelectorAll('.child-tab');
            childTabs.forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.getElementById(childName).style.display = 'block';
            
            // C·∫≠p nh·∫≠t ti·∫øn tr√¨nh v√† tr·∫°ng th√°i ph·∫ßn th∆∞·ªüng
            updateProgress();
            checkReward();
        }
        
        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.innerHTML = `<i class="fas fa-bell"></i> ${message}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
        
        // Ki·ªÉm tra th√¥ng b√°o d·ª±a tr√™n th·ªùi gian
        function checkTaskNotifications() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            
            const dateKey = getDateKey();
            
            // Ki·ªÉm tra c·∫£ hai b√©
            ['tridung', 'thaoVy'].forEach(childName => {
                if (scheduleData[childName][dateKey] && scheduleData[childName][dateKey].tasks) {
                    scheduleData[childName][dateKey].tasks.forEach(task => {
                        if (!task.isPreviousSleep) { // B·ªè qua nhi·ªám v·ª• ng·ªß c·ªßa ng√†y h√¥m tr∆∞·ªõc
                            const timeRange = task.time.split(' - ');
                            if (timeRange.length > 1) {
                                const startTime = timeRange[0].split(':');
                                const startHour = parseInt(startTime[0]);
                                const startMinute = parseInt(startTime[1]);
                                
                                if (hours === startHour && minutes === startMinute && !task.rating) {
                                    showNotification(`${childName === 'tridung' ? 'Tr√≠ D≈©ng' : 'Th·∫£o Vy'}: ƒê·∫øn gi·ªù ${task.name}`);
                                }
                            } else if (timeRange[0].includes(':')) {
                                const exactTime = timeRange[0].split(':');
                                const exactHour = parseInt(exactTime[0]);
                                const exactMinute = parseInt(exactTime[1]);
                                
                                if (hours === exactHour && minutes === exactMinute && !task.rating) {
                                    showNotification(`${childName === 'tridung' ? 'Tr√≠ D≈©ng' : 'Th·∫£o Vy'}: ƒê·∫øn gi·ªù ${task.name}`);
                                }
                            }
                        }
                    });
                }
            });
        }
        
        // Hi·ªÉn th·ªã/·∫©n modal th·ªëng k√™
        function toggleStats() {
            const statsModal = document.getElementById('statsModal');
            statsModal.classList.toggle('active');
            
            if (statsModal.classList.contains('active')) {
                updateStats();
            }
        }
        
        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            const statsChart = document.getElementById('statsChart');
            statsChart.innerHTML = '';
            
            // L·∫•y d·ªØ li·ªáu 7 ng√†y g·∫ßn nh·∫•t
            const last7Days = [];
            let totalPoints = 0;
            let deviceDays = 0;
            let bestDay = { date: null, points: 0 };
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - i);
                const dateKey = getDateKey(date);
                
                // Format ng√†y hi·ªÉn th·ªã
                const dayDisplay = date.getDate() + '/' + (date.getMonth() + 1);
                
                // D·ªØ li·ªáu ƒëi·ªÉm
                let dayPoints = 0;
                if (scheduleData[currentChild][dateKey] && scheduleData[currentChild][dateKey].totalPoints) {
                    dayPoints = scheduleData[currentChild][dateKey].totalPoints;
                }
                
                // Th√™m v√†o t·ªïng ƒëi·ªÉm
                totalPoints += dayPoints;
                
                // Ki·ªÉm tra ng√†y t·ªët nh·∫•t
                if (dayPoints > bestDay.points) {
                    bestDay = {
                        date: new Date(date),
                        points: dayPoints
                    };
                }
                
                // Ki·ªÉm tra xem ng√†y ƒë√≥ c√≥ ƒë∆∞·ª£c ch∆°i thi·∫øt b·ªã kh√¥ng
                const prevDate = new Date(date);
                prevDate.setDate(prevDate.getDate() - 1);
                const prevDateKey = getDateKey(prevDate);
                
                // ƒêi·ªÅu ki·ªán ƒë∆∞·ª£c ch∆°i thi·∫øt b·ªã: Ng·ªß t·ªët ng√†y h√¥m tr∆∞·ªõc + ƒëi·ªÉm cao ng√†y h√¥m nay
                let canUseDevice = false;
                
                if (scheduleData[currentChild][prevDateKey] && scheduleData[currentChild][dateKey]) {
                    const previousSleepTask = scheduleData[currentChild][prevDateKey].tasks?.find(t => t.id === 7);
                    const goodSleepYesterday = previousSleepTask && (previousSleepTask.rating === 'good' || previousSleepTask.rating === 'neutral');
                    const goodPointsToday = dayPoints >= 12;
                    
                    canUseDevice = goodSleepYesterday && goodPointsToday;
                    if (canUseDevice) deviceDays++;
                }
                
                // Th√™m v√†o m·∫£ng d·ªØ li·ªáu
                last7Days.push({
                    date: dayDisplay,
                    points: dayPoints,
                    canUseDevice: canUseDevice
                });
            }
            
            // T·∫°o bi·ªÉu ƒë·ªì
            last7Days.forEach(day => {
                // T√≠nh chi·ªÅu cao d·ª±a tr√™n ƒëi·ªÉm (t·ªëi ƒëa 21 ƒëi·ªÉm ~ chi·ªÅu cao 100%)
                const heightPercent = (day.points / 21) * 100;
                
                const barElement = document.createElement('div');
                barElement.className = `chart-bar ${day.canUseDevice ? 'good-btn' : ''}`;
                barElement.style.height = `${heightPercent}%`;
                
                barElement.innerHTML = `
                    <div class="chart-bar-value">${day.points}</div>
                    <div class="chart-bar-label">${day.date}</div>
                `;
                
                statsChart.appendChild(barElement);
            });
            
            // C·∫≠p nh·∫≠t t√≥m t·∫Øt th·ªëng k√™
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('averagePoints').textContent = (totalPoints / 7).toFixed(1);
            document.getElementById('deviceDays').textContent = deviceDays;
            
            if (bestDay.date) {
                const options = { weekday: 'long', day: 'numeric', month: 'numeric' };
                const bestDayStr = bestDay.date.toLocaleDateString('vi-VN', options);
                document.getElementById('bestDay').textContent = `${bestDayStr} (${bestDay.points} ƒëi·ªÉm)`;
            } else {
                document.getElementById('bestDay').textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu';
            }
        }
        
        // L∆∞u d·ªØ li·ªáu
        function saveData() {
            localStorage.setItem(storageKey, JSON.stringify(scheduleData));
        }
        
        // T·∫£i d·ªØ li·ªáu
        function loadData() {
            const savedData = localStorage.getItem(storageKey);
            if (savedData) {
                scheduleData = JSON.parse(savedData);
            }
            
            // Kh·ªüi t·∫°o ng√†y hi·ªán t·∫°i n·∫øu ch∆∞a c√≥
            initializeCurrentDate();
            
            updateDateDisplay();
            updateSleepRecord();
            renderTasks();
            checkReward();
        }
        
        // Kh·ªüi t·∫°o d·ªØ li·ªáu cho ng√†y hi·ªán t·∫°i n·∫øu ch∆∞a c√≥
        function initializeCurrentDate() {
            const dateKey = getDateKey();
            
            ['tridung', 'thaoVy'].forEach(child => {
                if (!scheduleData[child][dateKey]) {
                    scheduleData[child][dateKey] = {
                        tasks: [],
                        totalPoints: 0
                    };
                    
                    // T·∫°o c√°c nhi·ªám v·ª• t·ª´ template
                    scheduleData[child][dateKey].tasks = taskTemplates[child].map(template => {
                        return {
                            id: template.id,
                            time: template.time,
                            name: template.name,
                            isPreviousSleep: template.isPreviousSleep || false,
                            rating: null
                        };
                    });
                }
            });
        }
        
        // Ki·ªÉm tra th√¥ng b√°o m·ªói ph√∫t
        setInterval(checkTaskNotifications, 60000);
        
        // Th√™m s·ª± ki·ªán l∆∞u d·ªØ li·ªáu
        window.addEventListener('beforeunload', saveData);
        
        // Kh·ªüi ch·∫°y ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', loadData);
    </script>

<div id="popup-congrats" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); z-index:9999; text-align:center;">
<img alt="M·∫π Qu·ª≥nh" src="images/me_quynh.jpg" style="width:250px; border-radius:10px; box-shadow: 0 0 10px #888;"/>
<div id="popup-text" style="background:white; padding:10px; font-weight:bold; font-size:18px; margin-top:-5px;">B√© l√†m t·ªët l·∫Øm!</div>
</div>
<audio id="audio-congrats" preload="auto" src=""></audio>

<img id="watering-gif" src="images/water.gif" style="display:none; position:absolute; width:80px; top:30px; left:90px; z-index:10;"/>

<div style="text-align:center; margin-top:10px;">
<button onclick="waterTree()">üíß B√© t∆∞·ªõi n∆∞·ªõc cho c√¢y</button>
</div>

<script>
let waterUnits = 0;
let treeLevel = 1;

function playCongrats(taskName) {
  const messages = {
    "ƒÉn t·ªëi t·∫°i nh√†": "audio/an_toi_tai_nha.mp3",
    "v·ªá sinh c√° nh√¢n bu·ªïi t·ªëi": "audio/ve_sinh_ca_nhan_buoi_toi.mp3",
    "ƒë·ªçc s√°ch, t√¥ m√†u ho·∫∑c l√†m to√°n": "audio/doc_sach_to_mau_hoac_lam_toan.mp3",
    "ƒëi ng·ªß": "audio/di_ngu.mp3",
    "th·ª©c d·∫≠y, v·ªá sinh c√° nh√¢n, ƒëi h·ªçc": "audio/thuc_day_ve_sinh_ca_nhan_di_hoc.mp3",
    "ch∆°i t·ª± do": "audio/choi_tu_do.mp3",
    "v·ªá sinh c√° nh√¢n s√°ng": "audio/ve_sinh_ca_nhan_sang.mp3",
    "ng·ªß ƒë√™m qua": "audio/ngu_dem_qua.mp3"
  };

  const audio = document.getElementById("audio-congrats");
  const popup = document.getElementById("popup-congrats");
  const popupText = document.getElementById("popup-text");

  audio.src = messages[taskName] || "";
  audio.play();
  popupText.innerText = "Ch√∫c m·ª´ng anh V√≠t ho√†n th√†nh t·ªët nhi·ªám v·ª•: " + taskName;
  popup.style.display = "block";

  setTimeout(() => {
    popup.style.display = "none";
  }, 4000);
}

function addWater(units) {
  waterUnits += units;
  document.getElementById("watering-gif").style.display = "block";
  setTimeout(() => {
    document.getElementById("watering-gif").style.display = "none";
  }, 1500);
}

function waterTree() {
  if (waterUnits <= 0 || treeLevel >= 7) return;
  treeLevel++;
  waterUnits--;
  document.getElementById("tree-img").src = `images/tree_day${treeLevel}.png`;
}
</script>
</body>
</html>